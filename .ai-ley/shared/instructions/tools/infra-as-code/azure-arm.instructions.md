---
agentMode: general
applyTo: general
author: AI-LEY
description: Enterprise Azure Resource Manager (ARM) Templates - Comprehensive Level 3 infrastructure as code platform for Azure cloud-native enterprise deployments with multi-subscription orchestration, advanced Bicep patterns, compliance automation, comprehensive security frameworks, advanced monitoring integration, CI/CD automation, cost optimization, disaster recovery, governance standards, and production-scale enterprise capabilities.
extensions:
  - .md
  - .json
  - .bicep
guidelines: Enterprise ARM Templates with advanced Azure patterns, multi-subscription management, sophisticated compliance frameworks (SOC2, PCI-DSS, HIPAA, CIS, NIST, FedRAMP), security automation, comprehensive monitoring integration, cost optimization, disaster recovery automation, and production-ready enterprise governance.
instructionType: general
keywords:
  [
    'Azure',
    'ARM Templates',
    'Bicep',
    'Infrastructure as Code',
    'IaC',
    'Multi-subscription',
    'Azure Policy',
    'Compliance',
    'Security',
    'Monitoring',
    'CI/CD',
    'Cost Optimization',
    'Disaster Recovery',
    'Governance',
    'Enterprise',
    'SOC2',
    'PCI-DSS',
    'HIPAA',
    'CIS',
    'NIST',
    'FedRAMP',
    'Key Vault',
    'Managed Identity',
    'Azure Monitor',
    'DevOps',
    'GitHub Actions',
    'Reserved Instances',
    'Azure Advisor',
    'management-groups',
    'subscription-blueprints',
    'azure-sentinel',
    'security-center',
    'azure-firewall',
    'application-gateway',
    'load-balancer',
    'virtual-network',
    'nsg',
    'route-tables',
    'vpn-gateway',
    'expressroute',
    'private-endpoint',
    'service-endpoint',
    'vnet-peering',
    'azure-kubernetes-service',
    'container-instances',
    'container-registry',
    'app-service',
    'function-app',
    'logic-apps',
    'service-bus',
    'event-hubs',
    'event-grid',
    'storage-account',
    'blob-storage',
    'file-shares',
    'disk-storage',
    'managed-disks',
    'sql-database',
    'sql-managed-instance',
    'cosmos-db',
    'postgresql',
    'mysql',
    'redis-cache',
    'virtual-machines',
    'vmss',
    'availability-sets',
    'proximity-placement-groups',
    'dedicated-hosts',
    'backup-services',
    'site-recovery',
    'traffic-manager',
    'front-door',
    'cdn',
    'application-insights',
    'log-analytics',
    'automation-account',
    'recovery-services-vault',
    'azure-migrate',
    'data-factory',
    'synapse-analytics',
    'machine-learning',
    'cognitive-services',
    'bot-services',
    'api-management',
    'service-fabric',
    'batch',
    'hpc',
    'iot-hub',
    'iot-central',
    'digital-twins',
    'time-series-insights',
    'stream-analytics',
    'hdinsight',
    'databricks',
    'search',
    'media-services',
    'notification-hubs',
    'relay',
    'power-bi',
    'analysis-services',
    'data-lake',
    'purview',
    'azure-ad',
    'active-directory-ds',
    'b2c',
    'privileged-identity-management',
    'conditional-access',
    'identity-protection',
    'multi-factor-authentication',
    'rbac',
    'custom-roles',
    'resource-locks',
    'tags',
    'resource-groups',
    'subscriptions',
    'management-groups',
    'blueprints',
    'policy-definitions',
    'policy-assignments',
    'policy-initiatives',
    'regulatory-compliance',
    'security-benchmarks',
    'azure-arc',
    'lighthouse',
    'cost-management',
    'budgets',
    'cost-alerts',
    'advisor-recommendations',
    'well-architected-framework',
    'reliability',
    'performance-efficiency',
    'operational-excellence',
    'security',
    'cost-optimization',
    'sustainability',
    'devops-practices',
    'gitops',
    'infrastructure-testing',
    'chaos-engineering',
    'blue-green-deployment',
    'canary-deployment',
    'feature-flags',
    'configuration-management',
    'secrets-management',
    'certificate-management',
    'encryption',
    'key-rotation',
    'backup-retention',
    'disaster-recovery-planning',
    'business-continuity',
    'high-availability',
    'multi-region',
    'geo-redundancy',
    'cross-region-replication',
    'failover-groups',
    'traffic-routing',
    'health-probes',
    'auto-scaling',
    'performance-monitoring',
    'application-performance-monitoring',
    'synthetic-monitoring',
    'availability-monitoring',
    'security-monitoring',
    'compliance-monitoring',
    'audit-logging',
    'diagnostic-settings',
    'alerts',
    'action-groups',
    'webhooks',
    'runbooks',
    'automation-runbooks',
    'powershell-dsc',
    'arm-templates-advanced',
    'bicep-modules',
    'bicep-registries',
    'template-specs',
    'deployment-stacks',
    'what-if-deployments',
    'deployment-modes',
    'resource-dependencies',
    'conditional-deployment',
    'copy-loops',
    'nested-templates',
    'linked-templates',
    'cross-tenant-deployments',
    'tenant-deployments',
    'subscription-deployments',
    'management-group-deployments',
    'resource-group-deployments',
    'extension-resources',
    'custom-providers',
    'managed-applications',
    'marketplace-solutions',
    'partner-solutions',
    'third-party-integrations',
    'hybrid-cloud',
    'edge-computing',
    'azure-stack',
    'azure-edge-zones',
    'confidential-computing',
    'trusted-launch',
    'secure-boot',
    'attestation',
    'hsm',
    'key-vault-hsm',
    'dedicated-hsm',
    'confidential-ledger',
    'blockchain',
    'quantum-computing',
    'hpc-cache',
    'netapp-files',
    'elastic-san',
    'container-storage',
    'backup-center',
    'azure-vmware-solution',
    'bare-metal-infrastructure',
    'specialized-compute',
    'gpu-compute',
    'fpga',
    'quantum-development-kit',
    'azure-space',
    'satellite',
    'orbital',
    'communications',
    'defense',
    'government-cloud',
    'sovereign-cloud',
    'national-clouds',
    'china-cloud',
    'germany-cloud',
    'us-government',
    'compliance-frameworks',
    'industry-standards',
    'certifications',
    'auditing',
    'penetration-testing',
    'vulnerability-scanning',
    'threat-modeling',
    'risk-assessment',
    'incident-response',
    'forensics',
    'security-operations',
    'threat-intelligence',
    'security-automation',
    'orchestration',
    'playbooks',
    'investigation',
    'hunting',
    'analytics',
    'machine-learning-security',
    'behavioral-analytics',
    'user-entity-behavior-analytics',
    'security-information-event-management',
    'security-orchestration-automation-response',
    'extended-detection-response',
    'managed-detection-response',
    'cyber-threat-intelligence',
    'zero-trust-architecture',
    'conditional-access-policies',
    'device-compliance',
    'endpoint-protection',
    'mobile-device-management',
    'application-protection',
    'information-protection',
    'data-loss-prevention',
    'cloud-app-security',
    'defender-for-cloud',
    'defender-for-endpoint',
    'defender-for-office365',
    'defender-for-identity',
    'sentinel',
    'security-center',
    'key-vault-premium',
    'managed-hsm',
    'attestation-service',
    'confidential-computing-service',
    'always-encrypted',
    'transparent-data-encryption',
    'column-level-security',
    'row-level-security',
    'dynamic-data-masking',
    'sql-auditing',
    'threat-detection',
    'advanced-threat-protection',
    'vulnerability-assessment',
    'data-discovery-classification',
    'privacy-compliance',
    'gdpr',
    'ccpa',
    'pipeda',
    'data-residency',
    'data-sovereignty',
    'cross-border-data-transfer',
    'encryption-in-transit',
    'encryption-at-rest',
    'customer-managed-keys',
    'bring-your-own-key',
    'hold-your-own-key',
    'double-encryption',
    'infrastructure-encryption',
    'disk-encryption',
    'storage-service-encryption',
    'transport-layer-security',
    'certificate-pinning',
    'mutual-authentication',
    'network-security-groups',
    'application-security-groups',
    'azure-firewall-premium',
    'web-application-firewall',
    'ddos-protection',
    'private-link',
    'private-endpoints',
    'service-endpoints',
    'virtual-network-service-endpoints',
    'network-virtual-appliances',
    'route-server',
    'virtual-wan',
    'secure-hub',
    'firewall-manager',
    'network-watcher',
    'connection-monitor',
    'traffic-analytics',
    'flow-logs',
    'packet-capture',
    'network-performance-monitor',
    'express-route-monitoring',
    'vpn-diagnostics',
    'azure-bastion',
    'just-in-time-access',
    'adaptive-network-hardening',
    'file-integrity-monitoring',
    'adaptive-application-controls',
    'secure-score',
    'security-recommendations',
    'compliance-dashboard',
    'regulatory-compliance-dashboard',
    'security-alerts',
    'security-incidents',
    'threat-protection',
    'advanced-hunting',
    'custom-detection-rules',
    'analytics-rules',
    'fusion-correlation',
    'machine-learning-anomalies',
    'watchlists',
    'threat-indicators',
    'workbooks',
    'investigation-graph',
    'entity-behavior',
    'ueba',
    'notebooks',
    'hunting-queries',
    'community-content',
    'threat-intelligence-integration',
    'api-integrations',
    'custom-connectors',
    'logic-apps-integration',
    'automation-rules',
    'response-actions',
    'remediation',
    'containment',
    'isolation',
    'blocking',
    'enrichment',
    'notification',
    'ticketing-integration',
    'siem-integration',
    'soar-integration',
    'third-party-security-tools',
    'security-partners',
    'marketplace-security-solutions',
  ]
lastUpdated: '2025-09-05T00:00:00.000000'
summaryScore: 9.9
title: Azure ARM Templates Enterprise Platform
version: 4.0.0
---

# ðŸ—ï¸ Azure Resource Manager (ARM) Templates - Enterprise Cloud Platform

## ðŸ“‹ Enterprise Platform Overview

**Azure ARM Templates** is Microsoft's comprehensive Infrastructure as Code (IaC) solution providing declarative JSON-based templates and advanced Bicep DSL for deploying, managing, and orchestrating Azure resources at enterprise scale. This platform enables sophisticated multi-subscription deployments, comprehensive compliance automation, advanced security governance, enterprise monitoring integration, cost optimization, disaster recovery automation, and production-ready resource management across Azure cloud environments.

### ðŸŒŸ Advanced Enterprise Capabilities

- **Multi-Subscription Architecture**: Advanced Management Groups, Blueprints, Policy orchestration, cross-subscription deployments
- **Bicep Advanced Patterns**: Modular architecture, registries, template specs, deployment stacks, conditional deployments
- **Comprehensive Compliance**: SOC2, PCI-DSS, HIPAA, CIS, NIST, FedRAMP framework automation with evidence collection
- **Advanced Security**: Zero-trust architecture, Defender integration, Sentinel SIEM, Key Vault premium, managed HSM
- **Enterprise Monitoring**: Azure Monitor, Application Insights, Log Analytics, advanced alerting, custom workbooks
- **DevOps Integration**: Azure DevOps, GitHub Actions, advanced pipelines, GitOps workflows, automated testing
- **Cost Optimization**: Advanced budgeting, cost alerts, Advisor integration, reserved instance automation
- **Disaster Recovery**: Site Recovery, backup automation, cross-region replication, failover orchestration

### ðŸŽ¯ Core Enterprise Capabilities

- **Multi-Subscription Orchestration**: Deployment across multiple Azure subscriptions with centralized governance
- **Advanced ARM Patterns**: Nested templates, linked deployments, Bicep DSL, custom providers, and resource loops
- **Compliance Frameworks**: Built-in support for SOC2, PCI-DSS, HIPAA, CIS, and NIST compliance requirements
- **Security Automation**: Azure Key Vault integration, Managed Identity, RBAC, and Azure Policy enforcement
- **Monitoring Integration**: Azure Monitor, Log Analytics, Application Insights, and automated alerting
- **CI/CD Pipelines**: Azure DevOps, GitHub Actions, and automated deployment workflows
- **Cost Optimization**: Azure Advisor integration, Reserved Instances, and comprehensive cost management
- **Disaster Recovery**: Multi-region deployments, backup automation, and business continuity planning
- **Enterprise Governance**: Azure Policy, Management Groups, and centralized resource management

### ðŸ¢ Enterprise Use Cases

- **Multi-Tier Applications**: Web applications with load balancers, application tiers, and database clusters
- **Hybrid Cloud Integration**: On-premises connectivity with VPN, ExpressRoute, and Azure Arc
- **Microservices Architecture**: Container-based deployments with Azure Kubernetes Service and Service Fabric
- **Data Platform Deployments**: Big data analytics with Azure Synapse, Data Factory, and machine learning
- **Enterprise Networking**: Hub-spoke architectures, network security groups, and traffic management
- **Compliance Workloads**: Healthcare (HIPAA), financial services (PCI-DSS), and government (FedRAMP)
- **DevOps Automation**: Continuous integration/deployment with infrastructure as code workflows
- **Cost-Optimized Infrastructure**: Auto-scaling, Reserved Instances, and resource optimization

### ðŸ“Š Platform Integration Matrix

| **Component**         | **Purpose**                           | **Enterprise Features**                                       |
| --------------------- | ------------------------------------- | ------------------------------------------------------------- |
| **ARM Templates**     | Core IaC declarative JSON templates   | Multi-subscription, nested deployments, resource dependencies |
| **Bicep DSL**         | Modern ARM template language          | Type safety, modules, loops, advanced syntax                  |
| **Azure Policy**      | Governance and compliance automation  | Compliance frameworks, resource standards, audit controls     |
| **Key Vault**         | Secrets and certificate management    | Enterprise encryption, secret rotation, HSM support           |
| **Azure Monitor**     | Comprehensive monitoring and alerting | Log Analytics, metrics, dashboards, automated responses       |
| **Cost Management**   | Financial optimization and governance | Budgets, alerts, Reserved Instances, advisor recommendations  |
| **Azure DevOps**      | CI/CD and deployment automation       | Pipelines, approvals, testing, release management             |
| **Management Groups** | Hierarchical governance and RBAC      | Multi-subscription management, policy inheritance             |

### ðŸ”§ Tool Information

- **Primary Tool**: Azure Resource Manager (ARM) Templates
- **Modern Alternative**: Bicep Domain Specific Language (DSL)
- **Version**: Azure REST API 2023-07-01 (latest stable)
- **Category**: Infrastructure as Code (IaC) / Cloud Platform Management
- **Prerequisites**: Azure CLI, Azure PowerShell, appropriate Azure RBAC permissions
- **Enterprise Integration**: Azure DevOps, GitHub Actions, Key Vault, Monitor, Policy
- **Compliance Support**: SOC2, PCI-DSS, HIPAA, CIS, NIST, FedRAMP
- **Multi-Cloud**: Primary Azure focus with hybrid cloud capabilities

## ðŸ› ï¸ Enterprise Installation & Setup

### Azure Enterprise CLI Suite Installation

```bash
# Azure CLI v2 (latest) - Core ARM deployment engine
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash  # Linux
brew update && brew install azure-cli  # macOS
# Windows: Download from https://aka.ms/installazurecliwindows

# Azure PowerShell for advanced management
# Linux/macOS
pwsh -Command "Install-Module -Name Az -Repository PSGallery -Force"
# Windows PowerShell
Install-Module -Name Az -Repository PSGallery -Force

# Bicep CLI for modern ARM template development
az bicep install
az bicep upgrade

# Azure DevOps CLI for CI/CD automation
az extension add --name azure-devops
az extension update --name azure-devops

# Azure Policy CLI for governance automation
az extension add --name policy
az extension add --name resource-graph

# ARM Template Toolkit (arm-ttk) for validation
git clone https://github.com/Azure/arm-ttk.git
cd arm-ttk/arm-ttk
Import-Module ./arm-ttk.psd1

# Additional enterprise tools
az extension add --name application-insights  # APM integration
az extension add --name log-analytics         # Log management
az extension add --name security-insights     # Security monitoring
az extension add --name costmanagement        # Cost optimization
az extension add --name advisor               # Best practices

# Verify installations
az --version
bicep --version
pwsh -Command "Get-InstalledModule Az"
```

### Enterprise Azure Authentication & Multi-Subscription Setup

```bash
# Interactive authentication with device code
az login --use-device-code

# Service Principal authentication (for automation)
az login --service-principal \
  --username "$AZURE_CLIENT_ID" \
  --password "$AZURE_CLIENT_SECRET" \
  --tenant "$AZURE_TENANT_ID"

# Managed Identity authentication (for Azure VMs)
az login --identity

# Configure multi-subscription management
az account list --output table
az account set --subscription "Production-Subscription-ID"

# Set up subscription aliases for easy management
az account alias create --name "prod" --subscription "Production-Subscription-ID"
az account alias create --name "dev" --subscription "Development-Subscription-ID"
az account alias create --name "staging" --subscription "Staging-Subscription-ID"

# Configure default settings for enterprise consistency
az configure --defaults \
  location=eastus \
  group=rg-enterprise-shared \
  output=table

# Set up Azure Cloud Shell for consistent environment
# https://shell.azure.com
```

### Project Structure

```
arm-templates-project/
   templates/
      main.json
      nested/
         network.json
         compute.json
         storage.json
      modules/
          vm-module.json
          database-module.json
   parameters/
      dev.parameters.json
      staging.parameters.json
      prod.parameters.json
   scripts/
      deploy.sh
      validate.sh
   bicep/
      main.bicep
   README.md
```

## Configuration

## ðŸ”§ Enterprise Configuration & Template Architecture

### Enterprise ARM Template Foundation Structure

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "3.0.0.0",
  "metadata": {
    "title": "Enterprise Foundation Template",
    "description": "Comprehensive enterprise foundation with multi-subscription governance, compliance frameworks, security automation, monitoring integration, and cost optimization",
    "author": "Enterprise Platform Team",
    "version": "3.0.0",
    "lastModified": "2025-09-05",
    "compliance": ["SOC2", "PCI-DSS", "HIPAA", "CIS", "NIST"],
    "environments": ["dev", "staging", "production"],
    "regions": ["eastus", "westus", "westeurope", "eastus2"],
    "subscriptions": "multi-subscription-aware",
    "governance": "Azure Policy integrated",
    "monitoring": "Azure Monitor native",
    "security": "Key Vault + Managed Identity",
    "cost-optimization": "Azure Advisor integrated",
    "disaster-recovery": "multi-region-capable"
  },
  "parameters": {
    "enterprisePrefix": {
      "type": "string",
      "minLength": 2,
      "maxLength": 10,
      "defaultValue": "enterprise",
      "metadata": {
        "description": "Enterprise naming prefix for all resources"
      }
    },
    "environment": {
      "type": "string",
      "allowedValues": ["dev", "staging", "production"],
      "defaultValue": "dev",
      "metadata": {
        "description": "Target deployment environment"
      }
    },
    "complianceFramework": {
      "type": "string",
      "allowedValues": ["SOC2", "PCI-DSS", "HIPAA", "CIS", "NIST"],
      "defaultValue": "SOC2",
      "metadata": {
        "description": "Primary compliance framework to implement"
      }
    },
    "primaryRegion": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Primary Azure region for resource deployment"
      }
    },
    "enableAdvancedSecurity": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable advanced security features (Key Vault, Defender, etc.)"
      }
    },
    "enableComplianceMonitoring": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable compliance monitoring and reporting"
      }
    },
    "enableCostOptimization": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable cost optimization features and budgets"
      }
    }
  },
  "variables": {
    "namingConvention": {
      "resourceGroup": "[concat(parameters('enterprisePrefix'), '-', parameters('environment'), '-rg')]",
      "keyVault": "[concat(parameters('enterprisePrefix'), '-', parameters('environment'), '-kv-', uniqueString(resourceGroup().id))]",
      "logAnalytics": "[concat(parameters('enterprisePrefix'), '-', parameters('environment'), '-law-', uniqueString(resourceGroup().id))]",
      "managedIdentity": "[concat(parameters('enterprisePrefix'), '-', parameters('environment'), '-mi')]"
    },
    "complianceConfiguration": {
      "SOC2": {
        "auditRetentionDays": 2555,
        "encryptionRequired": true,
        "backupRequired": true,
        "monitoringLevel": "comprehensive"
      },
      "PCI-DSS": {
        "auditRetentionDays": 365,
        "encryptionRequired": true,
        "networkSegmentation": true,
        "monitoringLevel": "detailed"
      },
      "HIPAA": {
        "auditRetentionDays": 2190,
        "encryptionRequired": true,
        "accessLogging": true,
        "monitoringLevel": "comprehensive"
      }
    },
    "currentCompliance": "[variables('complianceConfiguration')[parameters('complianceFramework')]]",
    "enterpriseTags": {
      "Environment": "[parameters('environment')]",
      "ComplianceFramework": "[parameters('complianceFramework')]",
      "ManagedBy": "ARM-Templates",
      "DeploymentDate": "[utcNow('yyyy-MM-dd')]",
      "SecurityEnabled": "[parameters('enableAdvancedSecurity')]",
      "ComplianceMonitoring": "[parameters('enableComplianceMonitoring')]",
      "CostOptimization": "[parameters('enableCostOptimization')]"
    }
  },
  "resources": [
    {
      "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
      "apiVersion": "2023-01-31",
      "name": "[variables('namingConvention').managedIdentity]",
      "location": "[parameters('primaryRegion')]",
      "tags": "[variables('enterpriseTags')]"
    },
    {
      "condition": "[parameters('enableAdvancedSecurity')]",
      "type": "Microsoft.KeyVault/vaults",
      "apiVersion": "2023-07-01",
      "name": "[variables('namingConvention').keyVault]",
      "location": "[parameters('primaryRegion')]",
      "tags": "[variables('enterpriseTags')]",
      "properties": {
        "sku": {
          "family": "A",
          "name": "[if(equals(parameters('environment'), 'production'), 'premium', 'standard')]"
        },
        "tenantId": "[subscription().tenantId]",
        "enabledForDeployment": true,
        "enabledForTemplateDeployment": true,
        "enabledForDiskEncryption": true,
        "enableRbacAuthorization": true,
        "enableSoftDelete": true,
        "enablePurgeProtection": "[if(equals(parameters('environment'), 'production'), true, false)]",
        "softDeleteRetentionInDays": "[variables('currentCompliance').auditRetentionDays]",
        "publicNetworkAccess": "Disabled",
        "networkAcls": {
          "defaultAction": "Deny",
          "bypass": "AzureServices"
        }
      }
    }
  ],
  "outputs": {
    "managedIdentityPrincipalId": {
      "type": "string",
      "value": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('namingConvention').managedIdentity), '2023-01-31').principalId]"
    },
    "keyVaultUri": {
      "condition": "[parameters('enableAdvancedSecurity')]",
      "type": "string",
      "value": "[if(parameters('enableAdvancedSecurity'), reference(resourceId('Microsoft.KeyVault/vaults', variables('namingConvention').keyVault), '2023-07-01').vaultUri, '')]"
    }
  }
}
```

### Multi-Subscription Enterprise Architecture & Advanced Governance

```bicep
// management-group-structure.bicep - Enterprise Management Group Hierarchy
targetScope = 'tenant'

@description('Organization name for naming conventions')
param organizationName string = 'Enterprise'

@description('Root management group configuration')
param rootManagementGroup object = {
  id: 'enterprise-root'
  displayName: 'Enterprise Root Management Group'
  description: 'Root management group for enterprise governance'
}

@description('Management group hierarchy configuration')
param managementGroupHierarchy array = [
  {
    id: 'enterprise-platform'
    displayName: 'Platform Management Group'
    description: 'Platform services and shared infrastructure'
    parentId: 'enterprise-root'
    subscriptions: []
  }
  {
    id: 'enterprise-landing-zones'
    displayName: 'Landing Zones Management Group'
    description: 'Application landing zones'
    parentId: 'enterprise-root'
    subscriptions: []
  }
  {
    id: 'enterprise-production'
    displayName: 'Production Landing Zones'
    description: 'Production application workloads'
    parentId: 'enterprise-landing-zones'
    subscriptions: ['subscription-prod-001', 'subscription-prod-002']
  }
  {
    id: 'enterprise-non-production'
    displayName: 'Non-Production Landing Zones'
    description: 'Development and testing workloads'
    parentId: 'enterprise-landing-zones'
    subscriptions: ['subscription-dev-001', 'subscription-test-001']
  }
  {
    id: 'enterprise-sandbox'
    displayName: 'Sandbox Management Group'
    description: 'Sandbox environments for experimentation'
    parentId: 'enterprise-root'
    subscriptions: ['subscription-sandbox-001']
  }
  {
    id: 'enterprise-decommissioned'
    displayName: 'Decommissioned Management Group'
    description: 'Decommissioned subscriptions with restricted access'
    parentId: 'enterprise-root'
    subscriptions: []
  }
]

// Create root management group
resource rootMg 'Microsoft.Management/managementGroups@2023-04-01' = {
  name: rootManagementGroup.id
  properties: {
    displayName: rootManagementGroup.displayName
    details: {
      parent: {
        id: '/providers/Microsoft.Management/managementGroups/${tenant().tenantId}'
      }
    }
  }
}

// Create management group hierarchy
resource managementGroups 'Microsoft.Management/managementGroups@2023-04-01' = [for mg in managementGroupHierarchy: {
  name: mg.id
  dependsOn: [rootMg]
  properties: {
    displayName: mg.displayName
    details: {
      parent: {
        id: '/providers/Microsoft.Management/managementGroups/${mg.parentId}'
      }
    }
  }
}]

// Enterprise Policy Definitions
resource enterpriseSecurityPolicy 'Microsoft.Authorization/policyDefinitions@2023-04-01' = {
  name: 'enterprise-security-baseline'
  properties: {
    displayName: 'Enterprise Security Baseline'
    description: 'Comprehensive security baseline for enterprise workloads'
    policyType: 'Custom'
    mode: 'All'
    metadata: {
      category: 'Security'
      version: '1.0.0'
      source: 'Enterprise IT'
    }
    parameters: {
      effect: {
        type: 'String'
        allowedValues: ['Audit', 'Deny', 'DeployIfNotExists', 'AuditIfNotExists']
        defaultValue: 'Audit'
        metadata: {
          displayName: 'Effect'
          description: 'Enable or disable the execution of the policy'
        }
      }
      requiredTags: {
        type: 'Array'
        defaultValue: [
          'Environment'
          'Owner'
          'Project'
          'CostCenter'
          'DataClassification'
          'BusinessUnit'
        ]
        metadata: {
          displayName: 'Required Tags'
          description: 'List of required tags for all resources'
        }
      }
    }
    policyRule: {
      if: {
        allOf: [
          {
            field: 'type'
            notIn: [
              'Microsoft.Resources/resourceGroups'
              'Microsoft.Resources/subscriptions'
            ]
          }
          {
            anyOf: [
              for tag in parameters('requiredTags'): {
                field: 'tags[\'${tag}\']'
                exists: 'false'
              }
            ]
          }
        ]
      }
      then: {
        effect: '[parameters(\'effect\')]'
        details: {
          type: 'Microsoft.Resources/tags'
          roleDefinitionIds: [
            '/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c' // Contributor
          ]
          deployment: {
            properties: {
              mode: 'incremental'
              template: {
                '$schema': 'https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#'
                contentVersion: '1.0.0.0'
                parameters: {
                  resourceName: {
                    type: 'string'
                  }
                  resourceType: {
                    type: 'string'
                  }
                  requiredTags: {
                    type: 'array'
                  }
                }
                resources: [
                  {
                    type: 'Microsoft.Resources/tags'
                    name: 'default'
                    apiVersion: '2021-04-01'
                    properties: {
                      tags: {
                        Environment: '[if(empty(reference(resourceId(parameters(\'resourceType\'), parameters(\'resourceName\')), \'2021-04-01\', \'Full\').tags.Environment), \'NotSpecified\', reference(resourceId(parameters(\'resourceType\'), parameters(\'resourceName\')), \'2021-04-01\', \'Full\').tags.Environment)]'
                        Owner: '[if(empty(reference(resourceId(parameters(\'resourceType\'), parameters(\'resourceName\')), \'2021-04-01\', \'Full\').tags.Owner), \'NotSpecified\', reference(resourceId(parameters(\'resourceType\'), parameters(\'resourceName\')), \'2021-04-01\', \'Full\').tags.Owner)]'
                        Project: '[if(empty(reference(resourceId(parameters(\'resourceType\'), parameters(\'resourceName\')), \'2021-04-01\', \'Full\').tags.Project), \'NotSpecified\', reference(resourceId(parameters(\'resourceType\'), parameters(\'resourceName\')), \'2021-04-01\', \'Full\').tags.Project)]'
                        CostCenter: '[if(empty(reference(resourceId(parameters(\'resourceType\'), parameters(\'resourceName\')), \'2021-04-01\', \'Full\').tags.CostCenter), \'NotSpecified\', reference(resourceId(parameters(\'resourceType\'), parameters(\'resourceName\')), \'2021-04-01\', \'Full\').tags.CostCenter)]'
                      }
                    }
                  }
                ]
              }
              parameters: {
                resourceName: {
                  value: '[field(\'name\')]'
                }
                resourceType: {
                  value: '[field(\'type\')]'
                }
                requiredTags: {
                  value: '[parameters(\'requiredTags\')]'
                }
              }
            }
          }
        }
      }
    }
  }
}

// Enterprise Blueprint Definition
resource enterpriseBlueprint 'Microsoft.Blueprint/blueprints@2018-11-01-preview' = {
  name: 'enterprise-landing-zone-blueprint'
  properties: {
    displayName: 'Enterprise Landing Zone Blueprint'
    description: 'Comprehensive landing zone blueprint for enterprise workloads'
    targetScope: 'subscription'
    parameters: {
      environment: {
        type: 'string'
        allowedValues: [
          'production'
          'development'
          'testing'
          'staging'
        ]
        metadata: {
          displayName: 'Environment'
          description: 'The environment for this landing zone'
        }
      }
      workloadName: {
        type: 'string'
        maxLength: 10
        metadata: {
          displayName: 'Workload Name'
          description: 'Short name for the workload'
        }
      }
      deploymentRegion: {
        type: 'string'
        allowedValues: [
          'eastus2'
          'westus2'
          'centralus'
          'eastus'
          'westeurope'
          'northeurope'
        ]
        metadata: {
          displayName: 'Deployment Region'
          description: 'Primary Azure region for deployment'
        }
      }
    }
    resourceGroups: {
      networkingRG: {
        displayName: 'Networking Resource Group'
        description: 'Resource group for networking components'
        location: '[parameters(\'deploymentRegion\')]'
        tags: {
          Purpose: 'Networking'
          Environment: '[parameters(\'environment\')]'
        }
      }
      securityRG: {
        displayName: 'Security Resource Group'
        description: 'Resource group for security components'
        location: '[parameters(\'deploymentRegion\')]'
        tags: {
          Purpose: 'Security'
          Environment: '[parameters(\'environment\')]'
        }
      }
      monitoringRG: {
        displayName: 'Monitoring Resource Group'
        description: 'Resource group for monitoring components'
        location: '[parameters(\'deploymentRegion\')]'
        tags: {
          Purpose: 'Monitoring'
          Environment: '[parameters(\'environment\')]'
        }
      }
      workloadRG: {
        displayName: 'Workload Resource Group'
        description: 'Resource group for workload components'
        location: '[parameters(\'deploymentRegion\')]'
        tags: {
          Purpose: 'Workload'
          Environment: '[parameters(\'environment\')]'
          WorkloadName: '[parameters(\'workloadName\')]'
        }
      }
    }
  }
}

// Blueprint Artifacts
resource networkingArtifact 'Microsoft.Blueprint/blueprints/artifacts@2018-11-01-preview' = {
  parent: enterpriseBlueprint
  name: 'networking-foundation'
  kind: 'template'
  properties: {
    displayName: 'Networking Foundation'
    description: 'Deploy enterprise networking foundation'
    resourceGroup: 'networkingRG'
    template: {
      '$schema': 'https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#'
      contentVersion: '1.0.0.0'
      parameters: {
        vnetAddressPrefix: {
          type: 'string'
          defaultValue: '10.0.0.0/16'
        }
      }
      resources: [
        {
          type: 'Microsoft.Network/virtualNetworks'
          apiVersion: '2023-05-01'
          name: '[concat(\'vnet-\', parameters(\'workloadName\'), \'-\', parameters(\'environment\'))]'
          location: '[parameters(\'deploymentRegion\')]'
          properties: {
            addressSpace: {
              addressPrefixes: [
                '[parameters(\'vnetAddressPrefix\')]'
              ]
            }
            subnets: [
              {
                name: 'subnet-web'
                properties: {
                  addressPrefix: '10.0.1.0/24'
                  networkSecurityGroup: {
                    id: '[resourceId(\'Microsoft.Network/networkSecurityGroups\', concat(\'nsg-web-\', parameters(\'workloadName\'), \'-\', parameters(\'environment\')))]'
                  }
                }
              }
              {
                name: 'subnet-app'
                properties: {
                  addressPrefix: '10.0.2.0/24'
                  networkSecurityGroup: {
                    id: '[resourceId(\'Microsoft.Network/networkSecurityGroups\', concat(\'nsg-app-\', parameters(\'workloadName\'), \'-\', parameters(\'environment\')))]'
                  }
                }
              }
              {
                name: 'subnet-data'
                properties: {
                  addressPrefix: '10.0.3.0/24'
                  networkSecurityGroup: {
                    id: '[resourceId(\'Microsoft.Network/networkSecurityGroups\', concat(\'nsg-data-\', parameters(\'workloadName\'), \'-\', parameters(\'environment\')))]'
                  }
                }
              }
            ]
          }
        }
      ]
    }
  }
}

output managementGroupIds array = [for mg in managementGroupHierarchy: {
  id: mg.id
  displayName: mg.displayName
}]

output blueprintDefinitionId string = enterpriseBlueprint.id
output policyDefinitionId string = enterpriseSecurityPolicy.id
```

### Advanced Bicep Modules and Registry Integration

```bicep
// bicep-registry-modules.bicep - Enterprise Bicep Module Registry
targetScope = 'subscription'

@description('Container registry for Bicep modules')
param moduleRegistryName string = 'acrenterprisemodules'

@description('Resource group for module registry')
param moduleRegistryRG string = 'rg-bicep-modules'

@description('Location for resources')
param location string = deployment().location

// Resource group for module registry
resource moduleRegistryResourceGroup 'Microsoft.Resources/resourceGroups@2023-07-01' = {
  name: moduleRegistryRG
  location: location
  tags: {
    Purpose: 'BicepModules'
    Environment: 'Shared'
    ManagedBy: 'InfrastructureTeam'
  }
}

// Container Registry for Bicep modules
module moduleRegistry '../modules/container-registry.bicep' = {
  name: 'bicep-module-registry'
  scope: moduleRegistryResourceGroup
  params: {
    registryName: moduleRegistryName
    location: location
    sku: 'Premium'
    adminUserEnabled: false
    anonymousPullEnabled: false
    networkRuleBypassOptions: 'AzureServices'
    publicNetworkAccess: 'Enabled'
    zoneRedundancy: 'Enabled'
    retentionDays: 30
    trustPolicy: {
      status: 'enabled'
      type: 'Notary'
    }
    quarantinePolicy: {
      status: 'enabled'
    }
    tags: {
      Purpose: 'BicepModuleRegistry'
      Environment: 'Shared'
    }
  }
}

// Template Specs for reusable templates
resource networkingTemplateSpec 'Microsoft.Resources/templateSpecs@2022-02-01' = {
  name: 'enterprise-networking-template'
  location: location
  properties: {
    displayName: 'Enterprise Networking Template Spec'
    description: 'Standardized networking components for enterprise workloads'
    metadata: {
      version: '1.0.0'
      author: 'Enterprise Architecture Team'
      category: 'Networking'
    }
  }
  tags: {
    Purpose: 'TemplateSpec'
    Category: 'Networking'
    Version: '1.0.0'
  }
}

resource networkingTemplateSpecVersion 'Microsoft.Resources/templateSpecs/versions@2022-02-01' = {
  parent: networkingTemplateSpec
  name: '1.0.0'
  location: location
  properties: {
    description: 'Initial version of enterprise networking template'
    metadata: {
      changelog: 'Initial release with VNet, subnets, NSGs, and security configurations'
    }
    template: {
      '$schema': 'https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#'
      contentVersion: '1.0.0.0'
      metadata: {
        description: 'Enterprise networking foundation with security controls'
      }
      parameters: {
        vnetName: {
          type: 'string'
          metadata: {
            description: 'Name of the virtual network'
          }
        }
        addressPrefix: {
          type: 'string'
          defaultValue: '10.0.0.0/16'
          metadata: {
            description: 'Address prefix for the VNet'
          }
        }
        subnets: {
          type: 'array'
          defaultValue: [
            {
              name: 'web-tier'
              addressPrefix: '10.0.1.0/24'
              securityRules: [
                {
                  name: 'AllowHTTPS'
                  properties: {
                    protocol: 'Tcp'
                    sourcePortRange: '*'
                    destinationPortRange: '443'
                    sourceAddressPrefix: 'Internet'
                    destinationAddressPrefix: '*'
                    access: 'Allow'
                    priority: 100
                    direction: 'Inbound'
                  }
                }
              ]
            }
            {
              name: 'app-tier'
              addressPrefix: '10.0.2.0/24'
              securityRules: [
                {
                  name: 'AllowWebTier'
                  properties: {
                    protocol: 'Tcp'
                    sourcePortRange: '*'
                    destinationPortRange: '8080'
                    sourceAddressPrefix: '10.0.1.0/24'
                    destinationAddressPrefix: '*'
                    access: 'Allow'
                    priority: 100
                    direction: 'Inbound'
                  }
                }
              ]
            }
            {
              name: 'data-tier'
              addressPrefix: '10.0.3.0/24'
              securityRules: [
                {
                  name: 'AllowAppTier'
                  properties: {
                    protocol: 'Tcp'
                    sourcePortRange: '*'
                    destinationPortRange: '1433'
                    sourceAddressPrefix: '10.0.2.0/24'
                    destinationAddressPrefix: '*'
                    access: 'Allow'
                    priority: 100
                    direction: 'Inbound'
                  }
                }
              ]
            }
          ]
          metadata: {
            description: 'Array of subnet configurations'
          }
        }
      }
      resources: [
        {
          type: 'Microsoft.Network/networkSecurityGroups'
          apiVersion: '2023-05-01'
          name: '[concat(\'nsg-\', parameters(\'subnets\')[copyIndex()].name)]'
          location: '[resourceGroup().location]'
          copy: {
            name: 'nsgLoop'
            count: '[length(parameters(\'subnets\'))]'
          }
          properties: {
            securityRules: '[parameters(\'subnets\')[copyIndex()].securityRules]'
          }
          tags: {
            Tier: '[parameters(\'subnets\')[copyIndex()].name]'
          }
        }
        {
          type: 'Microsoft.Network/virtualNetworks'
          apiVersion: '2023-05-01'
          name: '[parameters(\'vnetName\')]'
          location: '[resourceGroup().location]'
          dependsOn: [
            'nsgLoop'
          ]
          properties: {
            addressSpace: {
              addressPrefixes: [
                '[parameters(\'addressPrefix\')]'
              ]
            }
            subnets: '[map(parameters(\'subnets\'), lambda(\'subnet\', createObject(\'name\', subnet.name, \'properties\', createObject(\'addressPrefix\', subnet.addressPrefix, \'networkSecurityGroup\', createObject(\'id\', resourceId(\'Microsoft.Network/networkSecurityGroups\', concat(\'nsg-\', subnet.name)))))))]'
          }
        }
      ]
      outputs: {
        vnetId: {
          type: 'string'
          value: '[resourceId(\'Microsoft.Network/virtualNetworks\', parameters(\'vnetName\'))]'
        }
        subnetIds: {
          type: 'array'
          value: '[map(parameters(\'subnets\'), lambda(\'subnet\', resourceId(\'Microsoft.Network/virtualNetworks/subnets\', parameters(\'vnetName\'), subnet.name)))]'
        }
      }
    }
  }
}

output moduleRegistryId string = moduleRegistry.outputs.registryId
output moduleRegistryLoginServer string = moduleRegistry.outputs.loginServer
output networkingTemplateSpecId string = networkingTemplateSpec.id
```

### Advanced Security & Compliance Frameworks

```bicep
// security-compliance-foundation.bicep - Comprehensive Security and Compliance
targetScope = 'subscription'

@description('Environment type for security configuration')
@allowed(['production', 'staging', 'development', 'sandbox'])
param environment string = 'production'

@description('Compliance frameworks to implement')
param complianceFrameworks array = [
  'SOC2'
  'PCI-DSS'
  'HIPAA'
  'CIS'
  'NIST'
]

@description('Data classification level')
@allowed(['public', 'internal', 'confidential', 'restricted'])
param dataClassification string = 'confidential'

@description('Location for security resources')
param location string = deployment().location

// Security Resource Group
resource securityResourceGroup 'Microsoft.Resources/resourceGroups@2023-07-01' = {
  name: 'rg-security-${environment}'
  location: location
  tags: {
    Purpose: 'Security'
    Environment: environment
    ComplianceFrameworks: join(complianceFrameworks, ',')
    DataClassification: dataClassification
  }
}

// Key Vault with Advanced Security
module keyVault '../modules/key-vault-premium.bicep' = {
  name: 'enterprise-keyvault-${environment}'
  scope: securityResourceGroup
  params: {
    keyVaultName: 'kv-enterprise-${environment}-${uniqueString(subscription().subscriptionId)}'
    location: location
    sku: 'premium'
    enabledForDeployment: true
    enabledForDiskEncryption: true
    enabledForTemplateDeployment: true
    enableSoftDelete: true
    softDeleteRetentionInDays: 90
    enablePurgeProtection: true
    enableRbacAuthorization: true
    networkAcls: {
      defaultAction: 'Deny'
      bypass: 'AzureServices'
      virtualNetworkRules: []
      ipRules: []
    }
    diagnosticSettings: [
      {
        name: 'security-monitoring'
        logAnalyticsWorkspaceId: securityLogAnalytics.outputs.workspaceId
        logs: [
          {
            category: 'AuditEvent'
            enabled: true
            retentionPolicy: {
              enabled: true
              days: 365
            }
          }
        ]
        metrics: [
          {
            category: 'AllMetrics'
            enabled: true
            retentionPolicy: {
              enabled: true
              days: 90
            }
          }
        ]
      }
    ]
    tags: {
      Purpose: 'SecuritySecrets'
      ComplianceFramework: join(complianceFrameworks, ',')
      DataClassification: dataClassification
    }
  }
}

// Azure Sentinel (Security Information and Event Management)
module sentinelWorkspace '../modules/sentinel-workspace.bicep' = {
  name: 'sentinel-${environment}'
  scope: securityResourceGroup
  params: {
    workspaceName: 'law-sentinel-${environment}'
    location: location
    sku: 'PerGB2018'
    retentionInDays: environment == 'production' ? 730 : 90
    dailyQuotaGb: environment == 'production' ? 100 : 10
    sentinelSolutions: [
      'SecurityInsights'
      'AzureActivity'
      'SecurityEvents'
      'WindowsFirewall'
      'DNS'
      'AzureKeyVault'
      'AzureStorage'
      'AzureSQL'
    ]
    dataConnectors: [
      'AzureActiveDirectory'
      'AzureSecurityCenter'
      'MicrosoftCloudAppSecurity'
      'MicrosoftDefenderForIdentity'
      'Office365'
    ]
    alertRules: [
      {
        displayName: 'Suspicious Key Vault Access'
        description: 'Detects unusual access patterns to Key Vault'
        severity: 'High'
        enabled: true
        query: '''
          KeyVaultData
          | where TimeGenerated > ago(1h)
          | where ResultDescription contains "Forbidden"
          | summarize count() by CallerIpAddress, identity_claim_upn_s
          | where count_ > 5
        '''
        queryFrequency: 'PT1H'
        queryPeriod: 'PT1H'
        triggerOperator: 'GreaterThan'
        triggerThreshold: 0
      }
      {
        displayName: 'Privileged Role Assignment'
        description: 'Detects assignment of privileged roles'
        severity: 'Medium'
        enabled: true
        query: '''
          AuditLogs
          | where TimeGenerated > ago(1h)
          | where OperationName == "Add member to role"
          | where TargetResources has "Global Administrator" or TargetResources has "Privileged Role Administrator"
        '''
        queryFrequency: 'PT1H'
        queryPeriod: 'PT1H'
        triggerOperator: 'GreaterThan'
        triggerThreshold: 0
      }
    ]
    workbooks: [
      'Azure AD Audit logs'
      'Azure AD Sign-in logs'
      'Azure Activity'
      'Security Alerts'
      'Compliance'
    ]
    tags: {
      Purpose: 'SecurityMonitoring'
      SIEM: 'Sentinel'
      ComplianceFramework: join(complianceFrameworks, ',')
    }
  }
}

// Security Log Analytics Workspace
module securityLogAnalytics '../modules/log-analytics-workspace.bicep' = {
  name: 'security-logs-${environment}'
  scope: securityResourceGroup
  params: {
    workspaceName: 'law-security-${environment}'
    location: location
    sku: 'PerGB2018'
    retentionInDays: environment == 'production' ? 2555 : 365 // 7 years for production SOC2 compliance
    dailyQuotaGb: environment == 'production' ? 50 : 5
    solutions: [
      'Security'
      'SecurityInsights'
      'KeyVaultAnalytics'
      'AzureActivity'
      'NetworkMonitoring'
      'ServiceMap'
    ]
    tags: {
      Purpose: 'SecurityLogging'
      RetentionYears: environment == 'production' ? '7' : '1'
      ComplianceFramework: join(complianceFrameworks, ',')
    }
  }
}

// Microsoft Defender for Cloud Configuration
resource defenderPlan 'Microsoft.Security/pricings@2023-01-01' = [for service in [
  'VirtualMachines'
  'SqlServers'
  'AppServices'
  'StorageAccounts'
  'KeyVaults'
  'Arm'
  'Dns'
  'KubernetesService'
  'ContainerRegistry'
  'Containers'
]: {
  name: service
  properties: {
    pricingTier: environment == 'production' ? 'Standard' : 'Free'
    subPlan: service == 'VirtualMachines' ? 'P2' : null
  }
}]

// Security Contacts Configuration
resource securityContacts 'Microsoft.Security/securityContacts@2023-03-01' = {
  name: 'security-team'
  properties: {
    emails: 'security-team@company.com;incident-response@company.com'
    alertNotifications: {
      state: 'On'
      minimalSeverity: 'Medium'
    }
    notificationsByRole: {
      state: 'On'
      roles: [
        'Owner'
        'ServiceAdmin'
        'AccountAdmin'
      ]
    }
  }
}

// Auto Provisioning Settings
resource autoProvisioningSettings 'Microsoft.Security/autoProvisioningSettings@2017-08-01-preview' = {
  name: 'default'
  properties: {
    autoProvision: 'On'
  }
}

// Compliance Assessment for SOC2
resource soc2Assessment 'Microsoft.Security/assessmentMetadata@2021-06-01' = if (contains(complianceFrameworks, 'SOC2')) {
  name: 'soc2-compliance-assessment'
  properties: {
    displayName: 'SOC 2 Compliance Assessment'
    description: 'Comprehensive SOC 2 compliance assessment for trust service criteria'
    severity: 'High'
    userImpact: 'High'
    implementationEffort: 'High'
    threats: [
      'dataExfiltration'
      'dataSpillage'
      'maliciousInsider'
      'accountBreach'
    ]
    categories: [
      'Data'
      'IdentityAndAccess'
      'IoT'
      'Networking'
      'Compute'
    ]
    assessmentType: 'BuiltIn'
    policyDefinitionId: resourceId('Microsoft.Authorization/policyDefinitions', 'enterprise-soc2-baseline')
  }
}

// PCI-DSS Compliance Configuration
resource pciDssInitiative 'Microsoft.Authorization/policySetDefinitions@2023-04-01' = if (contains(complianceFrameworks, 'PCI-DSS')) {
  name: 'enterprise-pci-dss-initiative'
  properties: {
    displayName: 'Enterprise PCI-DSS Compliance Initiative'
    description: 'Comprehensive PCI-DSS compliance controls for payment card data protection'
    policyType: 'Custom'
    metadata: {
      category: 'Compliance'
      version: '1.0.0'
      source: 'Enterprise Security Team'
      pciDssVersion: '4.0'
    }
    parameters: {
      effect: {
        type: 'String'
        defaultValue: 'AuditIfNotExists'
        allowedValues: [
          'AuditIfNotExists'
          'Disabled'
        ]
      }
    }
    policyDefinitions: [
      {
        policyDefinitionId: '/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9' // Storage accounts should use customer-managed key for encryption
        parameters: {
          effect: {
            value: '[parameters(\'effect\')]'
          }
        }
        policyDefinitionReferenceId: 'pci-requirement-3-4'
        groupNames: [
          'PCI_DSS_3.4'
        ]
      }
      {
        policyDefinitionId: '/providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d' // Key vaults should have purge protection enabled
        parameters: {
          effect: {
            value: '[parameters(\'effect\')]'
          }
        }
        policyDefinitionReferenceId: 'pci-requirement-3-6'
        groupNames: [
          'PCI_DSS_3.6'
        ]
      }
      {
        policyDefinitionId: '/providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490' // Firewall should be enabled on Key Vault
        parameters: {
          effect: {
            value: '[parameters(\'effect\')]'
          }
        }
        policyDefinitionReferenceId: 'pci-requirement-1-3'
        groupNames: [
          'PCI_DSS_1.3'
        ]
      }
    ]
    policyDefinitionGroups: [
      {
        name: 'PCI_DSS_1.3'
        displayName: 'Requirement 1.3 - Prohibit direct public access between external networks and components'
        description: 'Install perimeter firewalls between all external networks and components that store cardholder data'
      }
      {
        name: 'PCI_DSS_3.4'
        displayName: 'Requirement 3.4 - Render Primary Account Numbers unreadable'
        description: 'Use strong cryptography to render cardholder data unreadable'
      }
      {
        name: 'PCI_DSS_3.6'
        displayName: 'Requirement 3.6 - Protect cryptographic keys'
        description: 'Fully document and implement key-management processes and procedures for cryptographic keys'
      }
    ]
  }
}

// HIPAA Compliance for Healthcare Data
resource hipaaSecurityRules 'Microsoft.Authorization/policyDefinition@2023-04-01' = if (contains(complianceFrameworks, 'HIPAA')) {
  name: 'enterprise-hipaa-security-rule'
  properties: {
    displayName: 'HIPAA Security Rule Compliance'
    description: 'Implement HIPAA Security Rule requirements for protected health information (PHI)'
    policyType: 'Custom'
    mode: 'Indexed'
    metadata: {
      category: 'Healthcare'
      version: '1.0.0'
      hipaaSection: '164.312'
      description: 'Administrative, physical, and technical safeguards for electronic PHI'
    }
    parameters: {
      requiredEncryption: {
        type: 'Boolean'
        defaultValue: true
        metadata: {
          displayName: 'Require Encryption'
          description: 'Require encryption for all PHI storage and transmission'
        }
      }
      auditRetentionDays: {
        type: 'Integer'
        defaultValue: 2555 // 7 years
        metadata: {
          displayName: 'Audit Log Retention (Days)'
          description: 'Minimum retention period for audit logs'
        }
      }
    }
    policyRule: {
      if: {
        allOf: [
          {
            field: 'type'
            in: [
              'Microsoft.Storage/storageAccounts'
              'Microsoft.Sql/servers'
              'Microsoft.DocumentDB/databaseAccounts'
            ]
          }
          {
            field: 'tags[\'DataClassification\']'
            equals: 'PHI'
          }
        ]
      }
      then: {
        effect: 'AuditIfNotExists'
        details: {
          type: 'Microsoft.Insights/diagnosticSettings'
          existenceCondition: {
            allOf: [
              {
                count: {
                  field: 'Microsoft.Insights/diagnosticSettings/logs[*]'
                  where: {
                    allOf: [
                      {
                        field: 'Microsoft.Insights/diagnosticSettings/logs[*].enabled'
                        equals: 'True'
                      }
                      {
                        field: 'Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days'
                        greaterOrEquals: '[parameters(\'auditRetentionDays\')]'
                      }
                    ]
                  }
                }
                greaterOrEquals: 1
              }
            ]
          }
        }
      }
    }
  }
}

// Advanced Threat Protection Configuration
resource advancedThreatProtection 'Microsoft.Security/advancedThreatProtectionSettings@2019-01-01' = {
  name: 'current'
  scope: keyVault
  properties: {
    isEnabled: true
  }
}

output keyVaultId string = keyVault.outputs.keyVaultId
output sentinelWorkspaceId string = sentinelWorkspace.outputs.workspaceId
output securityLogAnalyticsId string = securityLogAnalytics.outputs.workspaceId
output complianceInitiatives array = [
  soc2Assessment.id
  pciDssInitiative.id
  hipaaSecurityRules.id
]
```

### Enterprise Azure DevOps Integration & CI/CD

```bicep
// azure-devops-integration.bicep - Enterprise CI/CD Pipeline
targetScope = 'subscription'

@description('Azure DevOps organization name')
param azureDevOpsOrganization string

@description('Azure DevOps project name')
param azureDevOpsProject string

@description('Repository name for infrastructure code')
param repositoryName string = 'enterprise-infrastructure'

@description('Environment for pipeline configuration')
param environment string = 'production'

@description('Service connection name')
param serviceConnectionName string = 'azure-enterprise-connection'

// Resource group for DevOps resources
resource devopsResourceGroup 'Microsoft.Resources/resourceGroups@2023-07-01' = {
  name: 'rg-devops-${environment}'
  location: deployment().location
  tags: {
    Purpose: 'DevOps'
    Environment: environment
    ManagedBy: 'InfrastructureTeam'
  }
}

// Container Registry for build artifacts
module containerRegistry '../modules/container-registry.bicep' = {
  name: 'devops-container-registry'
  scope: devopsResourceGroup
  params: {
    registryName: 'acrdevops${uniqueString(subscription().subscriptionId)}'
    location: deployment().location
    sku: 'Premium'
    adminUserEnabled: false
    publicNetworkAccess: 'Enabled'
    networkRuleBypassOptions: 'AzureServices'
    policies: {
      quarantinePolicy: {
        status: 'enabled'
      }
      trustPolicy: {
        status: 'enabled'
        type: 'Notary'
      }
      retentionPolicy: {
        status: 'enabled'
        days: 30
      }
    }
    diagnosticSettings: [
      {
        name: 'registry-monitoring'
        logAnalyticsWorkspaceId: devopsLogAnalytics.outputs.workspaceId
        logs: [
          {
            category: 'ContainerRegistryRepositoryEvents'
            enabled: true
          }
          {
            category: 'ContainerRegistryLoginEvents'
            enabled: true
          }
        ]
        metrics: [
          {
            category: 'AllMetrics'
            enabled: true
          }
        ]
      }
    ]
    tags: {
      Purpose: 'BuildArtifacts'
      Environment: environment
    }
  }
}

// Log Analytics for DevOps monitoring
module devopsLogAnalytics '../modules/log-analytics-workspace.bicep' = {
  name: 'devops-monitoring'
  scope: devopsResourceGroup
  params: {
    workspaceName: 'law-devops-${environment}'
    location: deployment().location
    sku: 'PerGB2018'
    retentionInDays: 90
    dailyQuotaGb: 10
    solutions: [
      'ContainerInsights'
      'AzureActivity'
      'SecurityInsights'
    ]
    tags: {
      Purpose: 'DevOpsMonitoring'
      Environment: environment
    }
  }
}

// Key Vault for DevOps secrets
module devopsKeyVault '../modules/key-vault.bicep' = {
  name: 'devops-secrets'
  scope: devopsResourceGroup
  params: {
    keyVaultName: 'kv-devops-${uniqueString(subscription().subscriptionId)}'
    location: deployment().location
    sku: 'standard'
    enableSoftDelete: true
    softDeleteRetentionInDays: 30
    enablePurgeProtection: false
    enableRbacAuthorization: true
    networkAcls: {
      defaultAction: 'Allow'
      bypass: 'AzureServices'
    }
    secrets: [
      {
        name: 'azure-devops-pat'
        value: 'placeholder-token'
        contentType: 'Azure DevOps Personal Access Token'
      }
      {
        name: 'container-registry-password'
        value: 'placeholder-password'
        contentType: 'Container Registry Admin Password'
      }
    ]
    tags: {
      Purpose: 'DevOpsSecrets'
      Environment: environment
    }
  }
}

output containerRegistryId string = containerRegistry.outputs.registryId
output containerRegistryLoginServer string = containerRegistry.outputs.loginServer
output devopsKeyVaultId string = devopsKeyVault.outputs.keyVaultId
output devopsLogAnalyticsId string = devopsLogAnalytics.outputs.workspaceId
```

        }
      }
    },
    "azurePolicyConfiguration": {
      "type": "object",
      "defaultValue": {
        "initiatives": {
          "security": {
            "name": "enterprise-security-baseline",
            "displayName": "Enterprise Security Baseline",
            "description": "Comprehensive security policies for enterprise compliance",
            "policies": [
              "require-storage-encryption",
              "require-key-vault-integration",
              "require-managed-identity",
              "require-network-security-groups",
              "require-diagnostic-settings"
            ]
          },
          "compliance": {
            "name": "enterprise-compliance-framework",
            "displayName": "Enterprise Compliance Framework",
            "description": "Multi-framework compliance automation (SOC2, PCI-DSS, HIPAA)",
            "policies": [
              "audit-retention-policy",
              "encryption-in-transit-required",
              "backup-policy-required",
              "access-logging-required"
            ]
          }
        }
      }
    }

}
}

````

### Environment-Specific Parameters Configuration

```bash
# Development environment configuration
cat > parameters/environments/dev/enterprise-foundation.parameters.json << 'EOF'
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "enterprisePrefix": {
      "value": "dev-enterprise"
    },
    "environment": {
      "value": "dev"
    },
    "complianceFramework": {
      "value": "CIS"
    },
    "enableMultiRegion": {
      "value": false
    },
    "enableAdvancedSecurity": {
      "value": true
    },
    "enableComplianceMonitoring": {
      "value": false
    },
    "budgetAmount": {
      "value": 500
    },
    "costCenterTag": {
      "value": "Development"
    },
    "dataClassification": {
      "value": "internal"
    }
  }
}
EOF

# Production environment configuration
cat > parameters/environments/production/enterprise-foundation.parameters.json << 'EOF'
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "enterprisePrefix": {
      "value": "prod-enterprise"
    },
    "environment": {
      "value": "production"
    },
    "complianceFramework": {
      "value": "SOC2"
    },
    "enableMultiRegion": {
      "value": true
    },
    "enableAdvancedSecurity": {
      "value": true
    },
    "enableComplianceMonitoring": {
      "value": true
    },
    "budgetAmount": {
      "value": 10000
    },
    "costCenterTag": {
      "value": "Operations"
    },
    "dataClassification": {
      "value": "confidential"
    }
  }
}
EOF
````

      "metadata": {
        "description": "Environment name"
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Location for all resources"
      }
    },
    "adminUsername": {
      "type": "string",
      "metadata": {
        "description": "Admin username for virtual machine"
      }
    },
    "adminPassword": {
      "type": "securestring",
      "minLength": 12,
      "metadata": {
        "description": "Admin password for virtual machine"
      }
    },
    "vmSize": {
      "type": "string",
      "defaultValue": "Standard_B2s",
      "allowedValues": ["Standard_B1s", "Standard_B2s", "Standard_D2s_v3", "Standard_D4s_v3"],
      "metadata": {
        "description": "Virtual machine size"
      }
    }

},
"variables": {
"namingPrefix": "[concat(parameters('environment'), '-webapp')]",
"vnetName": "[concat(variables('namingPrefix'), '-vnet')]",
"subnetName": "[concat(variables('namingPrefix'), '-subnet')]",
"nsgName": "[concat(variables('namingPrefix'), '-nsg')]",
"vmName": "[concat(variables('namingPrefix'), '-vm')]",
"nicName": "[concat(variables('namingPrefix'), '-nic')]",
"publicIpName": "[concat(variables('namingPrefix'), '-pip')]",
"storageAccountName": "[concat(replace(variables('namingPrefix'), '-', ''), uniqueString(resourceGroup().id))]",
"sqlServerName": "[concat(variables('namingPrefix'), '-sql-', uniqueString(resourceGroup().id))]",
"databaseName": "[concat(variables('namingPrefix'), '-db')]"
},
"resources": [
{
"type": "Microsoft.Network/networkSecurityGroups",
"apiVersion": "2021-02-01",
"name": "[variables('nsgName')]",
"location": "[parameters('location')]",
"properties": {
"securityRules": [
{
"name": "AllowHTTP",
"properties": {
"priority": 100,
"protocol": "Tcp",
"access": "Allow",
"direction": "Inbound",
"sourceAddressPrefix": "*",
"sourcePortRange": "*",
"destinationAddressPrefix": "*",
"destinationPortRange": "80"
}
},
{
"name": "AllowHTTPS",
"properties": {
"priority": 110,
"protocol": "Tcp",
"access": "Allow",
"direction": "Inbound",
"sourceAddressPrefix": "*",
"sourcePortRange": "*",
"destinationAddressPrefix": "*",
"destinationPortRange": "443"
}
},
{
"name": "AllowSSH",
"properties": {
"priority": 120,
"protocol": "Tcp",
"access": "Allow",
"direction": "Inbound",
"sourceAddressPrefix": "*",
"sourcePortRange": "*",
"destinationAddressPrefix": "*",
"destinationPortRange": "22"
}
}
]
},
"tags": {
"Environment": "[parameters('environment')]",
"Purpose": "Network Security"
}
},
{
"type": "Microsoft.Network/virtualNetworks",
"apiVersion": "2021-02-01",
"name": "[variables('vnetName')]",
"location": "[parameters('location')]",
"dependsOn": [
"[resourceId('Microsoft.Network/networkSecurityGroups', variables('nsgName'))]"
],
"properties": {
"addressSpace": {
"addressPrefixes": ["10.0.0.0/16"]
},
"subnets": [
{
"name": "[variables('subnetName')]",
"properties": {
"addressPrefix": "10.0.1.0/24",
"networkSecurityGroup": {
"id": "[resourceId('Microsoft.Network/networkSecurityGroups', variables('nsgName'))]"
}
}
}
]
},
"tags": {
"Environment": "[parameters('environment')]",
"Purpose": "Network Infrastructure"
}
}
],
"outputs": {
"vnetId": {
"type": "string",
"value": "[resourceId('Microsoft.Network/virtualNetworks', variables('vnetName'))]"
},
"subnetId": {
"type": "string",
"value": "[resourceId('Microsoft.Network/virtualNetworks/subnets', variables('vnetName'), variables('subnetName'))]"
},
"resourceGroupName": {
"type": "string",
"value": "[resourceGroup().name]"
}
}
}

````

### Parameters File

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "environment": {
      "value": "dev"
    },
    "adminUsername": {
      "value": "azureuser"
    },
    "adminPassword": {
      "reference": {
        "keyVault": {
          "id": "/subscriptions/{subscription-id}/resourceGroups/myRG/providers/Microsoft.KeyVault/vaults/myKeyVault"
        },
        "secretName": "vmAdminPassword"
      }
    },
    "vmSize": {
      "value": "Standard_B2s"
    }
  }
}
````

## Core Features

### Resource Deployment

- **Purpose**: Deploy Azure resources declaratively using JSON templates
- **Usage**: Define infrastructure as code with versioning and repeatability
- **Example**:

```bash
# Deploy resource group
az group create --name myResourceGroup --location "East US"

# Deploy ARM template
az deployment group create \
  --resource-group myResourceGroup \
  --template-file templates/main.json \
  --parameters parameters/dev.parameters.json

# Deploy with inline parameters
az deployment group create \
  --resource-group myResourceGroup \
  --template-file templates/main.json \
  --parameters environment=prod vmSize=Standard_D4s_v3

# Validate template before deployment
az deployment group validate \
  --resource-group myResourceGroup \
  --template-file templates/main.json \
  --parameters parameters/dev.parameters.json
```

### Nested and Linked Templates

- **Purpose**: Modularize complex deployments into reusable components
- **Usage**: Break large templates into smaller, manageable pieces
- **Example**:

```json
{
  "type": "Microsoft.Resources/deployments",
  "apiVersion": "2021-04-01",
  "name": "networkDeployment",
  "properties": {
    "mode": "Incremental",
    "templateLink": {
      "uri": "[concat(parameters('templateBaseUrl'), 'nested/network.json')]",
      "contentVersion": "1.0.0.0"
    },
    "parameters": {
      "vnetName": {
        "value": "[variables('vnetName')]"
      },
      "location": {
        "value": "[parameters('location')]"
      }
    }
  }
}

// Nested template - network.json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "vnetName": {
      "type": "string"
    },
    "location": {
      "type": "string"
    }
  },
  "resources": [
    {
      "type": "Microsoft.Network/virtualNetworks",
      "apiVersion": "2021-02-01",
      "name": "[parameters('vnetName')]",
      "location": "[parameters('location')]",
      "properties": {
        "addressSpace": {
          "addressPrefixes": ["10.0.0.0/16"]
        }
      }
    }
  ],
  "outputs": {
    "vnetId": {
      "type": "string",
      "value": "[resourceId('Microsoft.Network/virtualNetworks', parameters('vnetName'))]"
    }
  }
}
```

### Bicep Integration

- **Purpose**: Use Bicep DSL as a simpler alternative to JSON ARM templates
- **Usage**: Write infrastructure as code with better syntax and tooling
- **Example**:

```bicep
// main.bicep
@description('Environment name')
@allowed(['dev', 'staging', 'prod'])
param environment string = 'dev'

@description('Location for all resources')
param location string = resourceGroup().location

@description('Virtual machine size')
@allowed(['Standard_B1s', 'Standard_B2s', 'Standard_D2s_v3'])
param vmSize string = 'Standard_B2s'

@secure()
@description('Admin password for virtual machine')
param adminPassword string

var namingPrefix = '${environment}-webapp'
var vnetName = '${namingPrefix}-vnet'
var subnetName = '${namingPrefix}-subnet'
var vmName = '${namingPrefix}-vm'

// Network Security Group
resource networkSecurityGroup 'Microsoft.Network/networkSecurityGroups@2021-02-01' = {
  name: '${namingPrefix}-nsg'
  location: location
  properties: {
    securityRules: [
      {
        name: 'AllowHTTP'
        properties: {
          priority: 100
          protocol: 'Tcp'
          access: 'Allow'
          direction: 'Inbound'
          sourceAddressPrefix: '*'
          sourcePortRange: '*'
          destinationAddressPrefix: '*'
          destinationPortRange: '80'
        }
      }
      {
        name: 'AllowHTTPS'
        properties: {
          priority: 110
          protocol: 'Tcp'
          access: 'Allow'
          direction: 'Inbound'
          sourceAddressPrefix: '*'
          sourcePortRange: '*'
          destinationAddressPrefix: '*'
          destinationPortRange: '443'
        }
      }
    ]
  }
  tags: {
    Environment: environment
    Purpose: 'Network Security'
  }
}

// Virtual Network
resource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-02-01' = {
  name: vnetName
  location: location
  properties: {
    addressSpace: {
      addressPrefixes: ['10.0.0.0/16']
    }
    subnets: [
      {
        name: subnetName
        properties: {
          addressPrefix: '10.0.1.0/24'
          networkSecurityGroup: {
            id: networkSecurityGroup.id
          }
        }
      }
    ]
  }
  tags: {
    Environment: environment
    Purpose: 'Network Infrastructure'
  }
}

// Output values
output vnetId string = virtualNetwork.id
output subnetId string = virtualNetwork.properties.subnets[0].id

// Deploy Bicep template
// az deployment group create --resource-group myRG --template-file main.bicep --parameters environment=dev adminPassword=SecurePass123!
```

## Common Commands

```bash
# Resource group operations
az group create --name myResourceGroup --location "East US"
az group delete --name myResourceGroup --yes

# Template deployment
az deployment group create --resource-group myRG --template-file template.json --parameters @parameters.json
az deployment sub create --location "East US" --template-file subscription-template.json
az deployment mg create --management-group-id myMG --template-file mg-template.json

# Template validation and testing
az deployment group validate --resource-group myRG --template-file template.json
az deployment group what-if --resource-group myRG --template-file template.json

# Deployment operations
az deployment group list --resource-group myRG
az deployment group show --resource-group myRG --name myDeployment
az deployment group cancel --resource-group myRG --name myDeployment

# Bicep operations
az bicep install                    # Install Bicep CLI
az bicep build main.bicep          # Compile Bicep to ARM template
az bicep decompile template.json   # Convert ARM template to Bicep
```

### Advanced ARM Template Patterns & Nested Templates

#### Enterprise Nested Template Architecture

```json
{
  "resources": [
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2021-04-01",
      "name": "networkDeployment",
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('templateBaseUrl'), 'templates/modules/network.json')]",
          "contentVersion": "3.0.0.0"
        },
        "parameters": {
          "vnetName": {
            "value": "[variables('namingConvention').vnet]"
          },
          "addressSpace": {
            "value": "[parameters('networkConfiguration').addressSpace]"
          },
          "subnets": {
            "value": "[parameters('networkConfiguration').subnets]"
          },
          "enableDdosProtection": {
            "value": "[if(equals(parameters('environment'), 'production'), true, false)]"
          },
          "enableNetworkSecurityGroups": {
            "value": true
          },
          "complianceFramework": {
            "value": "[parameters('complianceFramework')]"
          },
          "tags": {
            "value": "[variables('enterpriseTags')]"
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2021-04-01",
      "name": "securityDeployment",
      "dependsOn": ["[resourceId('Microsoft.Resources/deployments', 'networkDeployment')]"],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('templateBaseUrl'), 'templates/modules/security.json')]",
          "contentVersion": "3.0.0.0"
        },
        "parameters": {
          "keyVaultName": {
            "value": "[variables('namingConvention').keyVault]"
          },
          "managedIdentityId": {
            "value": "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('namingConvention').managedIdentity)]"
          },
          "vnetId": {
            "value": "[reference('networkDeployment').outputs.vnetId.value]"
          },
          "enableAdvancedThreatProtection": {
            "value": "[if(equals(parameters('environment'), 'production'), true, false)]"
          },
          "complianceFramework": {
            "value": "[parameters('complianceFramework')]"
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2021-04-01",
      "name": "monitoringDeployment",
      "dependsOn": [
        "[resourceId('Microsoft.Resources/deployments', 'networkDeployment')]",
        "[resourceId('Microsoft.Resources/deployments', 'securityDeployment')]"
      ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('templateBaseUrl'), 'templates/modules/monitoring.json')]",
          "contentVersion": "3.0.0.0"
        },
        "parameters": {
          "logAnalyticsWorkspaceName": {
            "value": "[variables('namingConvention').logAnalytics]"
          },
          "applicationInsightsName": {
            "value": "[variables('namingConvention').appInsights]"
          },
          "retentionInDays": {
            "value": "[variables('currentCompliance').auditRetentionDays]"
          },
          "enableSentinel": {
            "value": "[if(equals(parameters('environment'), 'production'), true, false)]"
          },
          "alertingConfiguration": {
            "value": {
              "operationalEmail": "[parameters('alertEmail')]",
              "securityEmail": "[parameters('securityEmail')]",
              "enableBudgetAlerts": "[parameters('enableCostOptimization')]"
            }
          }
        }
      }
    }
  ]
}
```

#### Bicep Module Integration

```bicep
// templates/bicep/main/enterprise-foundation.bicep
@description('Enterprise prefix for resource naming')
param enterprisePrefix string = 'enterprise'

@description('Deployment environment')
@allowed(['dev', 'staging', 'production'])
param environment string = 'dev'

@description('Compliance framework to implement')
@allowed(['SOC2', 'PCI-DSS', 'HIPAA', 'CIS', 'NIST'])
param complianceFramework string = 'SOC2'

@description('Primary Azure region')
param primaryRegion string = resourceGroup().location

@description('Enable advanced security features')
param enableAdvancedSecurity bool = true

// Shared variables
var namingConvention = {
  resourceGroup: '${enterprisePrefix}-${environment}-rg'
  keyVault: '${enterprisePrefix}-${environment}-kv-${uniqueString(resourceGroup().id)}'
  managedIdentity: '${enterprisePrefix}-${environment}-mi'
  logAnalytics: '${enterprisePrefix}-${environment}-law-${uniqueString(resourceGroup().id)}'
}

var complianceConfiguration = {
  SOC2: {
    auditRetentionDays: 2555
    encryptionRequired: true
    backupRequired: true
    monitoringLevel: 'comprehensive'
  }
  'PCI-DSS': {
    auditRetentionDays: 365
    encryptionRequired: true
    networkSegmentation: true
    monitoringLevel: 'detailed'
  }
  HIPAA: {
    auditRetentionDays: 2190
    encryptionRequired: true
    accessLogging: true
    monitoringLevel: 'comprehensive'
  }
}

var currentCompliance = complianceConfiguration[complianceFramework]

// Enterprise foundation modules
module managedIdentity 'modules/identity.bicep' = {
  name: 'managedIdentityDeployment'
  params: {
    name: namingConvention.managedIdentity
    location: primaryRegion
    tags: {
      Environment: environment
      ComplianceFramework: complianceFramework
      ManagedBy: 'Bicep'
    }
  }
}

module keyVault 'modules/security/keyvault.bicep' = if (enableAdvancedSecurity) {
  name: 'keyVaultDeployment'
  params: {
    name: namingConvention.keyVault
    location: primaryRegion
    sku: environment == 'production' ? 'premium' : 'standard'
    enablePurgeProtection: environment == 'production'
    softDeleteRetentionInDays: currentCompliance.auditRetentionDays
    managedIdentityPrincipalId: managedIdentity.outputs.principalId
  }
  dependsOn: [
    managedIdentity
  ]
}

module logAnalytics 'modules/monitoring/log-analytics.bicep' = {
  name: 'logAnalyticsDeployment'
  params: {
    name: namingConvention.logAnalytics
    location: primaryRegion
    retentionInDays: currentCompliance.auditRetentionDays
    enableSentinel: environment == 'production'
  }
}

// Outputs
output managedIdentityId string = managedIdentity.outputs.id
output managedIdentityPrincipalId string = managedIdentity.outputs.principalId
output keyVaultUri string = enableAdvancedSecurity ? keyVault.outputs.vaultUri : ''
output logAnalyticsWorkspaceId string = logAnalytics.outputs.workspaceId
```

#### Custom ARM Template Providers & Functions

```json
{
  "functions": [
    {
      "namespace": "enterprise",
      "members": {
        "generateSecurePassword": {
          "parameters": [
            {
              "name": "length",
              "type": "int"
            }
          ],
          "output": {
            "type": "securestring",
            "value": "[concat('P@ssw0rd', uniqueString(resourceGroup().id), take(guid(), parameters('length')))]"
          }
        },
        "buildResourceName": {
          "parameters": [
            {
              "name": "resourceType",
              "type": "string"
            },
            {
              "name": "environment",
              "type": "string"
            },
            {
              "name": "region",
              "type": "string"
            }
          ],
          "output": {
            "type": "string",
            "value": "[concat(parameters('resourceType'), '-', parameters('environment'), '-', take(parameters('region'), 3), '-', uniqueString(resourceGroup().id))]"
          }
        },
        "getComplianceSettings": {
          "parameters": [
            {
              "name": "framework",
              "type": "string"
            }
          ],
          "output": {
            "type": "object",
            "value": {
              "auditRetention": "[if(equals(parameters('framework'), 'SOC2'), 2555, if(equals(parameters('framework'), 'HIPAA'), 2190, 365))]",
              "encryptionRequired": true,
              "networkIsolation": "[if(equals(parameters('framework'), 'PCI-DSS'), true, false)]"
            }
          }
        }
      }
    }
  ],
  "resources": [
    {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2023-01-01",
      "name": "[enterprise.buildResourceName('sa', parameters('environment'), parameters('primaryRegion'))]",
      "location": "[parameters('primaryRegion')]",
      "properties": {
        "minimumTlsVersion": "TLS1_2",
        "supportsHttpsTrafficOnly": true,
        "encryption": {
          "keySource": "Microsoft.Storage",
          "requireInfrastructureEncryption": "[enterprise.getComplianceSettings(parameters('complianceFramework')).encryptionRequired]",
          "services": {
            "blob": {
              "enabled": true,
              "keyType": "Account"
            },
            "file": {
              "enabled": true,
              "keyType": "Account"
            }
          }
        },
        "networkAcls": {
          "defaultAction": "[if(enterprise.getComplianceSettings(parameters('complianceFramework')).networkIsolation, 'Deny', 'Allow')]"
        }
      }
    }
  ]
}
```

#### Enterprise Copy Loops & Conditional Resources

```json
{
  "variables": {
    "regions": [
      {
        "name": "eastus",
        "isPrimary": true,
        "deploymentTier": "full"
      },
      {
        "name": "westus2",
        "isPrimary": false,
        "deploymentTier": "minimal"
      },
      {
        "name": "westeurope",
        "isPrimary": false,
        "deploymentTier": "disaster-recovery"
      }
    ],
    "networkConfigurations": [
      {
        "name": "frontend",
        "addressSpace": "10.0.1.0/24",
        "publicAccess": true,
        "securityLevel": "standard"
      },
      {
        "name": "backend",
        "addressSpace": "10.0.2.0/24",
        "publicAccess": false,
        "securityLevel": "enhanced"
      },
      {
        "name": "data",
        "addressSpace": "10.0.3.0/24",
        "publicAccess": false,
        "securityLevel": "maximum"
      }
    ]
  },
  "resources": [
    {
      "copy": {
        "name": "regionalDeployments",
        "count": "[length(variables('regions'))]",
        "mode": "parallel"
      },
      "condition": "[or(variables('regions')[copyIndex()].isPrimary, parameters('enableMultiRegion'))]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2021-04-01",
      "name": "[concat('regionalDeployment-', variables('regions')[copyIndex()].name)]",
      "resourceGroup": "[concat(parameters('enterprisePrefix'), '-', parameters('environment'), '-', variables('regions')[copyIndex()].name, '-rg')]",
      "properties": {
        "mode": "Incremental",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "copy": {
                "name": "subnetLoop",
                "count": "[length(variables('networkConfigurations'))]"
              },
              "type": "Microsoft.Network/virtualNetworks/subnets",
              "apiVersion": "2023-09-01",
              "name": "[concat(variables('namingConvention').vnet, '/', variables('networkConfigurations')[copyIndex('subnetLoop')].name)]",
              "properties": {
                "addressPrefix": "[variables('networkConfigurations')[copyIndex('subnetLoop')].addressSpace]",
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Disabled",
                "networkSecurityGroup": {
                  "id": "[resourceId('Microsoft.Network/networkSecurityGroups', concat(variables('networkConfigurations')[copyIndex('subnetLoop')].name, '-nsg'))]"
                }
              }
            }
          ]
        }
      }
    }
  ]
}
```

## ðŸŽ¯ Enterprise Best Practices & Security Framework

### Template Design Patterns

```json
// Use copy loops for multiple similar resources
{
  "type": "Microsoft.Compute/virtualMachines",
  "apiVersion": "2021-03-01",
  "name": "[concat(parameters('vmNamePrefix'), copyIndex(1))]",
  "location": "[parameters('location')]",
  "copy": {
    "name": "vmLoop",
    "count": "[parameters('vmCount')]"
  },
  "properties": {
    "hardwareProfile": {
      "vmSize": "[parameters('vmSize')]"
    }
  }
}

// Use conditions for optional resources
{
  "condition": "[equals(parameters('environment'), 'prod')]",
  "type": "Microsoft.Sql/servers",
  "apiVersion": "2021-02-01-preview",
  "name": "[variables('sqlServerName')]",
  "location": "[parameters('location')]",
  "properties": {
    "administratorLogin": "[parameters('sqlAdminUsername')]",
    "administratorLoginPassword": "[parameters('sqlAdminPassword')]"
  }
}

// Use resource dependencies
{
  "type": "Microsoft.Compute/virtualMachines",
  "apiVersion": "2021-03-01",
  "name": "[variables('vmName')]",
  "location": "[parameters('location')]",
  "dependsOn": [
    "[resourceId('Microsoft.Network/networkInterfaces', variables('nicName'))]",
    "[resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName'))]"
  ]
}
```

### Security and Compliance

```json
// Key Vault integration for secrets
{
  "parameters": {
    "adminPassword": {
      "reference": {
        "keyVault": {
          "id": "/subscriptions/{subscription-id}/resourceGroups/{rg}/providers/Microsoft.KeyVault/vaults/{vault-name}"
        },
        "secretName": "vmAdminPassword"
      }
    }
  }
}

// Managed Identity for secure access
{
  "type": "Microsoft.Compute/virtualMachines",
  "apiVersion": "2021-03-01",
  "name": "[variables('vmName')]",
  "location": "[parameters('location')]",
  "identity": {
    "type": "SystemAssigned"
  },
  "properties": {
    // VM properties
  }
}

// Role assignments
{
  "type": "Microsoft.Authorization/roleAssignments",
  "apiVersion": "2020-04-01-preview",
  "name": "[guid(resourceGroup().id, variables('vmName'), 'Reader')]",
  "dependsOn": [
    "[resourceId('Microsoft.Compute/virtualMachines', variables('vmName'))]"
  ],
  "properties": {
    "roleDefinitionId": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
    "principalId": "[reference(resourceId('Microsoft.Compute/virtualMachines', variables('vmName')), '2021-03-01', 'full').identity.principalId]",
    "principalType": "ServicePrincipal"
  }
}
```

## Common Use Cases

### Multi-Tier Web Application

**Scenario**: Deploy web application with load balancer, virtual machines, and database
**Implementation**:

```json
{
  "resources": [
    {
      "type": "Microsoft.Network/loadBalancers",
      "apiVersion": "2021-02-01",
      "name": "[variables('loadBalancerName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "Standard"
      },
      "properties": {
        "frontendIPConfigurations": [
          {
            "name": "LoadBalancerFrontEnd",
            "properties": {
              "publicIPAddress": {
                "id": "[resourceId('Microsoft.Network/publicIPAddresses', variables('publicIPName'))]"
              }
            }
          }
        ],
        "backendAddressPools": [
          {
            "name": "BackendPool"
          }
        ],
        "loadBalancingRules": [
          {
            "name": "HTTPRule",
            "properties": {
              "frontendIPConfiguration": {
                "id": "[concat(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName')), '/frontendIPConfigurations/LoadBalancerFrontEnd')]"
              },
              "backendAddressPool": {
                "id": "[concat(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName')), '/backendAddressPools/BackendPool')]"
              },
              "probe": {
                "id": "[concat(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName')), '/probes/HTTPProbe')]"
              },
              "protocol": "Tcp",
              "frontendPort": 80,
              "backendPort": 80
            }
          }
        ],
        "probes": [
          {
            "name": "HTTPProbe",
            "properties": {
              "protocol": "Http",
              "port": 80,
              "requestPath": "/health"
            }
          }
        ]
      }
    },
    {
      "type": "Microsoft.Compute/virtualMachineScaleSets",
      "apiVersion": "2021-03-01",
      "name": "[variables('vmssName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "[parameters('vmSize')]",
        "tier": "Standard",
        "capacity": "[parameters('instanceCount')]"
      },
      "properties": {
        "overprovision": false,
        "upgradePolicy": {
          "mode": "Rolling",
          "rollingUpgradePolicy": {
            "maxBatchInstancePercent": 20,
            "maxUnhealthyInstancePercent": 20,
            "maxUnhealthyUpgradedInstancePercent": 5,
            "pauseTimeBetweenBatches": "PT5M"
          }
        },
        "virtualMachineProfile": {
          "storageProfile": {
            "osDisk": {
              "createOption": "FromImage",
              "caching": "ReadWrite"
            },
            "imageReference": {
              "publisher": "Canonical",
              "offer": "0001-com-ubuntu-server-focal",
              "sku": "20_04-lts-gen2",
              "version": "latest"
            }
          },
          "osProfile": {
            "computerNamePrefix": "[variables('namingPrefix')]",
            "adminUsername": "[parameters('adminUsername')]",
            "adminPassword": "[parameters('adminPassword')]",
            "customData": "[base64(variables('cloudInitScript'))]"
          },
          "networkProfile": {
            "networkInterfaceConfigurations": [
              {
                "name": "nicConfig",
                "properties": {
                  "primary": true,
                  "ipConfigurations": [
                    {
                      "name": "ipConfig",
                      "properties": {
                        "subnet": {
                          "id": "[variables('subnetId')]"
                        },
                        "loadBalancerBackendAddressPools": [
                          {
                            "id": "[concat(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName')), '/backendAddressPools/BackendPool')]"
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        }
      }
    }
  ]
}
```

### Azure DevOps Integration

**Scenario**: Deploy infrastructure with Azure DevOps pipeline integration
**Implementation**:

```yaml
# azure-pipelines.yml
trigger:
  - main

variables:
  azureServiceConnection: 'azure-service-connection'
  resourceGroupName: 'rg-webapp-prod'
  location: 'East US'

stages:
  - stage: Validate
    jobs:
      - job: ValidateTemplate
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - task: AzureResourceManagerTemplateDeployment@3
            inputs:
              deploymentScope: 'Resource Group'
              azureResourceManagerConnection: $(azureServiceConnection)
              subscriptionId: $(subscriptionId)
              action: 'Create Or Update Resource Group'
              resourceGroupName: $(resourceGroupName)
              location: $(location)
              templateLocation: 'Linked artifact'
              csmFile: 'templates/main.json'
              csmParametersFile: 'parameters/prod.parameters.json'
              deploymentMode: 'Validation'

  - stage: Deploy
    dependsOn: Validate
    condition: succeeded()
    jobs:
      - deployment: DeployInfrastructure
        environment: 'production'
        pool:
          vmImage: 'ubuntu-latest'
        strategy:
          runOnce:
            deploy:
              steps:
                - task: AzureResourceManagerTemplateDeployment@3
                  inputs:
                    deploymentScope: 'Resource Group'
                    azureResourceManagerConnection: $(azureServiceConnection)
                    subscriptionId: $(subscriptionId)
                    action: 'Create Or Update Resource Group'
                    resourceGroupName: $(resourceGroupName)
                    location: $(location)
                    templateLocation: 'Linked artifact'
                    csmFile: 'templates/main.json'
                    csmParametersFile: 'parameters/prod.parameters.json'
                    deploymentMode: 'Incremental'
```

## Troubleshooting

### Common Issues

#### Issue 1: Template Validation Errors

**Problem**: Template fails validation due to syntax or reference errors
**Solution**: Use Azure CLI validation and check dependencies

```bash
# Validate template syntax
az deployment group validate \
  --resource-group myRG \
  --template-file template.json \
  --parameters @parameters.json

# Check template with detailed error output
az deployment group create \
  --resource-group myRG \
  --template-file template.json \
  --parameters @parameters.json \
  --debug
```

#### Issue 2: Resource Name Conflicts

**Problem**: Resource names must be globally unique but conflict with existing resources
**Solution**: Use unique functions and proper naming conventions

```json
{
  "variables": {
    "storageAccountName": "[concat('storage', uniqueString(resourceGroup().id))]",
    "webAppName": "[concat(parameters('appNamePrefix'), '-', uniqueString(resourceGroup().id))]"
  }
}
```

#### Issue 3: Dependency Resolution

**Problem**: Resources deploy in wrong order causing failures
**Solution**: Use explicit dependsOn or implicit dependencies

```json
{
  "dependsOn": [
    "[resourceId('Microsoft.Network/virtualNetworks', variables('vnetName'))]",
    "[resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName'))]"
  ]
}
```

## Security Considerations

### Access Control and RBAC

- Use Azure Active Directory for authentication
- Implement least privilege principle with custom RBAC roles
- Use managed identities instead of service principals where possible
- Enable Azure Policy for compliance enforcement

### Secret Management

````json
// Use Key Vault for sensitive parameters
{
  "parameters": {
    "sqlAdminPassword": {
      "reference": {
        "keyVault": {
          "id": "/subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.KeyVault/vaults/{vault}"
        },
        "secretName": "sqlAdminPassword"
      }
    }
  }
}

// Enable Key Vault soft delete and purge protection
{
  "type": "Microsoft.KeyVault/vaults",
```json
{
  "type": "Microsoft.KeyVault/vaults",
  "apiVersion": "2023-07-01",
  "name": "[variables('keyVaultName')]",
  "location": "[parameters('location')]",
  "properties": {
    "enableSoftDelete": true,
    "enablePurgeProtection": "[if(equals(parameters('environment'), 'production'), true, false)]",
    "softDeleteRetentionInDays": "[variables('complianceConfiguration')[parameters('complianceFramework')].auditRetentionDays]",
    "enableRbacAuthorization": true,
    "publicNetworkAccess": "Disabled",
    "networkAcls": {
      "defaultAction": "Deny",
      "bypass": "AzureServices"
    }
  },
  "tags": "[union(variables('enterpriseTags'), createObject('SecurityLevel', 'Maximum', 'ComplianceRequired', 'true'))]"
}
````

## ðŸ“Š Enterprise Monitoring & Observability Platform

### Comprehensive Azure Monitor Integration

```json
{
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces",
      "apiVersion": "2023-09-01",
      "name": "[variables('namingConvention').logAnalytics]",
      "location": "[parameters('primaryRegion')]",
      "properties": {
        "sku": {
          "name": "[if(equals(parameters('environment'), 'production'), 'PerGB2018', 'Free')]"
        },
        "retentionInDays": "[variables('currentCompliance').auditRetentionDays]",
        "features": {
          "legacy": 0,
          "searchVersion": 1,
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "enableDataExport": true
        },
        "workspaceCapping": {
          "dailyQuotaGb": "[if(equals(parameters('environment'), 'production'), 50, 1)]"
        },
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled"
      },
      "tags": "[union(variables('enterpriseTags'), createObject('MonitoringTier', 'Enterprise', 'DataRetention', string(variables('currentCompliance').auditRetentionDays)))]"
    },
    {
      "type": "Microsoft.Insights/components",
      "apiVersion": "2020-02-02",
      "name": "[variables('namingConvention').appInsights]",
      "location": "[parameters('primaryRegion')]",
      "kind": "web",
      "dependsOn": [
        "[resourceId('Microsoft.OperationalInsights/workspaces', variables('namingConvention').logAnalytics)]"
      ],
      "properties": {
        "Application_Type": "web",
        "WorkspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', variables('namingConvention').logAnalytics)]",
        "IngestionMode": "LogAnalytics",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "RetentionInDays": "[variables('currentCompliance').auditRetentionDays]",
        "SamplingPercentage": "[if(equals(parameters('environment'), 'production'), 10, 100)]"
      }
    },
    {
      "condition": "[and(equals(parameters('environment'), 'production'), parameters('enableAdvancedSecurity'))]",
      "type": "Microsoft.SecurityInsights/workspaces",
      "apiVersion": "2023-11-01",
      "scope": "[concat('Microsoft.OperationalInsights/workspaces/', variables('namingConvention').logAnalytics)]",
      "name": "default",
      "dependsOn": [
        "[resourceId('Microsoft.OperationalInsights/workspaces', variables('namingConvention').logAnalytics)]"
      ],
      "properties": {}
    },
    {
      "type": "Microsoft.Insights/actionGroups",
      "apiVersion": "2023-01-01",
      "name": "[concat(variables('namingConvention').resourceGroup, '-alerts')]",
      "location": "Global",
      "properties": {
        "groupShortName": "EntAlerts",
        "enabled": true,
        "emailReceivers": [
          {
            "name": "Operations Team",
            "emailAddress": "[parameters('alertEmail')]",
            "useCommonAlertSchema": true
          },
          {
            "name": "Security Team",
            "emailAddress": "[parameters('securityEmail')]",
            "useCommonAlertSchema": true
          }
        ],
        "smsReceivers": [],
        "webhookReceivers": [
          {
            "name": "Slack Integration",
            "serviceUri": "[if(empty(parameters('slackWebhookUrl')), 'https://hooks.slack.com/placeholder', parameters('slackWebhookUrl'))]",
            "useCommonAlertSchema": true
          }
        ],
        "azureFunctionReceivers": []
      }
    },
    {
      "copy": {
        "name": "alertRulesLoop",
        "count": "[length(variables('alertRules'))]"
      },
      "type": "Microsoft.Insights/metricAlerts",
      "apiVersion": "2018-03-01",
      "name": "[concat(variables('namingConvention').resourceGroup, '-', variables('alertRules')[copyIndex()].name)]",
      "location": "global",
      "dependsOn": [
        "[resourceId('Microsoft.Insights/actionGroups', concat(variables('namingConvention').resourceGroup, '-alerts'))]"
      ],
      "properties": {
        "description": "[variables('alertRules')[copyIndex()].description]",
        "severity": "[variables('alertRules')[copyIndex()].severity]",
        "enabled": true,
        "scopes": ["[resourceGroup().id]"],
        "evaluationFrequency": "PT5M",
        "windowSize": "PT15M",
        "criteria": "[variables('alertRules')[copyIndex()].criteria]",
        "actions": [
          {
            "actionGroupId": "[resourceId('Microsoft.Insights/actionGroups', concat(variables('namingConvention').resourceGroup, '-alerts'))]"
          }
        ]
      }
    }
  ],
  "variables": {
    "alertRules": [
      {
        "name": "high-cpu-usage",
        "description": "Alert when CPU usage exceeds 80% for 15 minutes",
        "severity": 2,
        "criteria": {
          "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria",
          "allOf": [
            {
              "name": "CPU Usage",
              "metricName": "Percentage CPU",
              "operator": "GreaterThan",
              "threshold": 80,
              "timeAggregation": "Average"
            }
          ]
        }
      },
      {
        "name": "key-vault-failed-requests",
        "description": "Alert on Key Vault authentication failures",
        "severity": 1,
        "criteria": {
          "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria",
          "allOf": [
            {
              "name": "Failed Requests",
              "metricName": "ServiceApiResult",
              "operator": "GreaterThan",
              "threshold": 5,
              "timeAggregation": "Count",
              "dimensions": [
                {
                  "name": "StatusCode",
                  "operator": "Include",
                  "values": ["403", "401"]
                }
              ]
            }
          ]
        }
      },
      {
        "name": "budget-threshold-exceeded",
        "description": "Alert when budget threshold is exceeded",
        "severity": 2,
        "criteria": {
          "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria",
          "allOf": [
            {
              "name": "Budget Usage",
              "metricName": "ActualCost",
              "operator": "GreaterThan",
              "threshold": "[mul(parameters('budgetAmount'), 0.8)]",
              "timeAggregation": "Total"
            }
          ]
        }
      }
    ]
  }
}
```

### Enterprise Workbooks & Dashboards

```json
{
  "resources": [
    {
      "type": "Microsoft.Insights/workbooks",
      "apiVersion": "2023-06-01",
      "name": "[guid(resourceGroup().id, 'enterprise-overview-workbook')]",
      "location": "[parameters('primaryRegion')]",
      "kind": "shared",
      "properties": {
        "displayName": "Enterprise Overview Dashboard",
        "serializedData": "[string(variables('enterpriseWorkbookTemplate'))]",
        "version": "Notebook/1.0",
        "sourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', variables('namingConvention').logAnalytics)]",
        "category": "workbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.OperationalInsights/workspaces', variables('namingConvention').logAnalytics)]"
      ]
    },
    {
      "type": "Microsoft.Portal/dashboards",
      "apiVersion": "2020-09-01-preview",
      "name": "[concat(variables('namingConvention').resourceGroup, '-dashboard')]",
      "location": "[parameters('primaryRegion')]",
      "properties": {
        "lenses": [
          {
            "order": 0,
            "parts": [
              {
                "position": {
                  "x": 0,
                  "y": 0,
                  "rowSpan": 4,
                  "colSpan": 6
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "resourceGroup",
                      "value": "[resourceGroup().id]"
                    }
                  ],
                  "type": "Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart"
                }
              },
              {
                "position": {
                  "x": 6,
                  "y": 0,
                  "rowSpan": 4,
                  "colSpan": 6
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "workspaceId",
                      "value": "[resourceId('Microsoft.OperationalInsights/workspaces', variables('namingConvention').logAnalytics)]"
                    }
                  ],
                  "type": "Extension/Microsoft_Azure_Monitoring/PartType/LogsDashboardPart"
                }
              }
            ]
          }
        ],
        "metadata": {
          "model": {
            "timeRange": {
              "value": {
                "relative": {
                  "duration": 24,
                  "timeUnit": 1
                }
              },
              "type": "MsPortalFx.Composition.Configuration.ValueTypes.TimeRange"
            }
          }
        },
        "tags": "[union(variables('enterpriseTags'), createObject('DashboardType', 'Enterprise', 'MonitoringScope', 'Production'))]"
      }
    }
  ],
  "variables": {
    "enterpriseWorkbookTemplate": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 1,
          "content": {
            "json": "# Enterprise Infrastructure Overview\n\nThis workbook provides comprehensive monitoring of enterprise infrastructure including security, compliance, performance, and cost optimization metrics."
          },
          "name": "text - 0"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "AzureMetrics\n| where ResourceGroup == \"{resourceGroup}\"\n| summarize avg(Average) by bin(TimeGenerated, 5m), MetricName\n| render timechart",
            "size": 0,
            "title": "Resource Performance Metrics",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "name": "query - 1"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "SecurityEvent\n| where EventID in (4624, 4625, 4648)\n| summarize count() by bin(TimeGenerated, 1h), Activity\n| render columnchart",
            "size": 0,
            "title": "Security Events",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "name": "query - 2"
        }
      ],
      "fallbackResourceIds": []
    }
  }
}
```

## ðŸš€ Enterprise CI/CD Pipeline Integration

### Azure DevOps Pipeline Templates

```yaml
# azure-pipelines/enterprise-arm-deployment.yml
trigger:
  branches:
    include:
      - main
      - develop
  paths:
    include:
      - templates/*
      - parameters/*
      - scripts/*

variables:
  - group: enterprise-variables
  - name: serviceConnection
    value: 'azure-service-connection'
  - name: templatePath
    value: 'templates/main/enterprise-foundation.json'

stages:
  - stage: Validate
    displayName: 'Validate ARM Templates'
    jobs:
      - job: ValidateTemplates
        displayName: 'Validate ARM Templates'
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - checkout: self

          - task: AzureCLI@2
            displayName: 'Install ARM TTK'
            inputs:
              azureSubscription: $(serviceConnection)
              scriptType: 'bash'
              scriptLocation: 'inlineScript'
              inlineScript: |
                git clone https://github.com/Azure/arm-ttk.git
                cd arm-ttk/arm-ttk
                Import-Module ./arm-ttk.psd1

          - task: AzureCLI@2
            displayName: 'Validate JSON Syntax'
            inputs:
              azureSubscription: $(serviceConnection)
              scriptType: 'bash'
              scriptLocation: 'inlineScript'
              inlineScript: |
                find templates/ -name "*.json" -exec jq empty {} \;
                echo "JSON syntax validation completed successfully"

          - task: AzureCLI@2
            displayName: 'Validate ARM Templates'
            inputs:
              azureSubscription: $(serviceConnection)
              scriptType: 'bash'
              scriptLocation: 'inlineScript'
              inlineScript: |
                for env in dev staging production; do
                  echo "Validating environment: $env"
                  az deployment group validate \
                    --resource-group "rg-enterprise-$env-validation" \
                    --template-file $(templatePath) \
                    --parameters "parameters/environments/$env/enterprise-foundation.parameters.json"
                done

          - task: AzureCLI@2
            displayName: 'Run ARM TTK Tests'
            inputs:
              azureSubscription: $(serviceConnection)
              scriptType: 'pwsh'
              scriptLocation: 'inlineScript'
              inlineScript: |
                Import-Module ./arm-ttk/arm-ttk/arm-ttk.psd1
                Test-AzTemplate -TemplatePath templates/main/ | Export-Clixml -Path arm-ttk-results.xml

          - task: PublishTestResults@2
            displayName: 'Publish ARM TTK Results'
            inputs:
              testResultsFormat: 'NUnit'
              testResultsFiles: 'arm-ttk-results.xml'
              testRunTitle: 'ARM Template Toolkit Tests'

  - stage: SecurityScan
    displayName: 'Security & Compliance Scan'
    dependsOn: Validate
    jobs:
      - job: SecurityScan
        displayName: 'Security Scan'
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - checkout: self

          - task: AzureCLI@2
            displayName: 'Run Security Baseline Scan'
            inputs:
              azureSubscription: $(serviceConnection)
              scriptType: 'bash'
              scriptLocation: 'inlineScript'
              inlineScript: |
                # Check for hardcoded secrets
                grep -r "password\|secret\|key" templates/ --include="*.json" || echo "No hardcoded secrets found"

                # Verify HTTPS enforcement
                jq -r '.resources[] | select(.type == "Microsoft.Storage/storageAccounts") | .properties.supportsHttpsTrafficOnly' templates/main/*.json

                # Check encryption settings
                jq -r '.resources[] | select(.type == "Microsoft.KeyVault/vaults") | .properties.enableSoftDelete' templates/main/*.json

          - task: AzureCLI@2
            displayName: 'Compliance Framework Validation'
            inputs:
              azureSubscription: $(serviceConnection)
              scriptType: 'bash'
              scriptLocation: 'inlineScript'
              inlineScript: |
                echo "Validating compliance framework requirements..."
                python3 scripts/compliance/validate-compliance.py --framework SOC2 --templates templates/

  - stage: DeployDev
    displayName: 'Deploy to Development'
    dependsOn: SecurityScan
    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/develop'))
    jobs:
      - deployment: DeployToDev
        displayName: 'Deploy to Development'
        pool:
          vmImage: 'ubuntu-latest'
        environment: 'development'
        strategy:
          runOnce:
            deploy:
              steps:
                - checkout: self

                - task: AzureCLI@2
                  displayName: 'What-If Analysis'
                  inputs:
                    azureSubscription: $(serviceConnection)
                    scriptType: 'bash'
                    scriptLocation: 'inlineScript'
                    inlineScript: |
                      az deployment group what-if \
                        --resource-group "rg-enterprise-dev" \
                        --template-file $(templatePath) \
                        --parameters "parameters/environments/dev/enterprise-foundation.parameters.json"

                - task: AzureCLI@2
                  displayName: 'Deploy ARM Template'
                  inputs:
                    azureSubscription: $(serviceConnection)
                    scriptType: 'bash'
                    scriptLocation: 'inlineScript'
                    inlineScript: |
                      az deployment group create \
                        --resource-group "rg-enterprise-dev" \
                        --template-file $(templatePath) \
                        --parameters "parameters/environments/dev/enterprise-foundation.parameters.json" \
                        --name "enterprise-dev-$(Build.BuildNumber)" \
                        --verbose

  - stage: DeployProduction
    displayName: 'Deploy to Production'
    dependsOn: SecurityScan
    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))
    jobs:
      - deployment: DeployToProduction
        displayName: 'Deploy to Production'
        pool:
          vmImage: 'ubuntu-latest'
        environment: 'production'
        strategy:
          runOnce:
            deploy:
              steps:
                - checkout: self

                - task: AzureCLI@2
                  displayName: 'Production Pre-Deployment Validation'
                  inputs:
                    azureSubscription: $(serviceConnection)
                    scriptType: 'bash'
                    scriptLocation: 'inlineScript'
                    inlineScript: |
                      echo "Running production pre-deployment checks..."
                      az deployment group validate \
                        --resource-group "rg-enterprise-production" \
                        --template-file $(templatePath) \
                        --parameters "parameters/environments/production/enterprise-foundation.parameters.json"

                - task: AzureCLI@2
                  displayName: 'Deploy to Production'
                  inputs:
                    azureSubscription: $(serviceConnection)
                    scriptType: 'bash'
                    scriptLocation: 'inlineScript'
                    inlineScript: |
                      az deployment group create \
                        --resource-group "rg-enterprise-production" \
                        --template-file $(templatePath) \
                        --parameters "parameters/environments/production/enterprise-foundation.parameters.json" \
                        --name "enterprise-prod-$(Build.BuildNumber)" \
                        --confirm-with-what-if \
                        --verbose
```

### GitHub Actions Workflow

```yaml
# .github/workflows/azure-arm-deployment.yml
name: Azure ARM Template Deployment

on:
  push:
    branches: [main, develop]
    paths:
      - 'templates/**'
      - 'parameters/**'
      - 'scripts/**'
  pull_request:
    branches: [main]
    paths:
      - 'templates/**'
      - 'parameters/**'

env:
  AZURE_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
  AZURE_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
  AZURE_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
  AZURE_CLIENT_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}

jobs:
  validate:
    runs-on: ubuntu-latest
    name: Validate ARM Templates
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Login to Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y jq
          az extension add --name azure-devops

      - name: Validate JSON Syntax
        run: |
          find templates/ -name "*.json" -exec jq empty {} \;

      - name: Validate ARM Templates
        run: |
          for env in dev staging production; do
            echo "Validating $env environment"
            az deployment group validate \
              --resource-group "rg-enterprise-$env-validation" \
              --template-file templates/main/enterprise-foundation.json \
              --parameters "parameters/environments/$env/enterprise-foundation.parameters.json"
          done

      - name: Run Security Scan
        run: |
          echo "Running security scan..."
          grep -r "password\|secret\|key" templates/ --include="*.json" && exit 1 || echo "No hardcoded secrets found"

  deploy-dev:
    if: github.ref == 'refs/heads/develop'
    needs: validate
    runs-on: ubuntu-latest
    environment: development
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Login to Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Deploy to Development
        run: |
          az deployment group create \
            --resource-group "rg-enterprise-dev" \
            --template-file templates/main/enterprise-foundation.json \
            --parameters parameters/environments/dev/enterprise-foundation.parameters.json \
            --name "github-actions-${{ github.run_number }}"

  deploy-production:
    if: github.ref == 'refs/heads/main'
    needs: validate
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Login to Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: What-If Analysis
        run: |
          az deployment group what-if \
            --resource-group "rg-enterprise-production" \
            --template-file templates/main/enterprise-foundation.json \
            --parameters parameters/environments/production/enterprise-foundation.parameters.json

      - name: Deploy to Production
        run: |
          az deployment group create \
            --resource-group "rg-enterprise-production" \
            --template-file templates/main/enterprise-foundation.json \
            --parameters parameters/environments/production/enterprise-foundation.parameters.json \
            --name "github-actions-prod-${{ github.run_number }}"
```

## ðŸ’° Cost Optimization & Budget Management

### Automated Budget Controls & Cost Management

```json
{
  "resources": [
    {
      "type": "Microsoft.Consumption/budgets",
      "apiVersion": "2023-11-01",
      "scope": "[concat('subscriptions/', subscription().subscriptionId)]",
      "name": "[concat(parameters('enterprisePrefix'), '-', parameters('environment'), '-budget')]",
      "properties": {
        "displayName": "[concat('Enterprise ', parameters('environment'), ' Budget')]",
        "amount": "[parameters('budgetAmount')]",
        "timeGrain": "Monthly",
        "timePeriod": {
          "startDate": "[utcNow('yyyy-MM-01')]",
          "endDate": "[dateTimeAdd(utcNow('yyyy-MM-01'), 'P1Y')]"
        },
        "filter": {
          "dimensions": {
            "name": "ResourceGroupName",
            "operator": "In",
            "values": ["[resourceGroup().name]"]
          }
        },
        "notifications": {
          "actual_GreaterThan_80_Percent": {
            "enabled": true,
            "operator": "GreaterThan",
            "threshold": 80,
            "contactEmails": ["[parameters('alertEmail')]", "[parameters('costManagerEmail')]"],
            "contactGroups": [],
            "thresholdType": "Actual"
          },
          "forecasted_GreaterThan_100_Percent": {
            "enabled": true,
            "operator": "GreaterThan",
            "threshold": 100,
            "contactEmails": ["[parameters('alertEmail')]", "[parameters('costManagerEmail')]"],
            "contactGroups": [],
            "thresholdType": "Forecasted"
          }
        }
      }
    },
    {
      "type": "Microsoft.Automation/automationAccounts",
      "apiVersion": "2023-11-01",
      "name": "[concat(variables('namingConvention').resourceGroup, '-automation')]",
      "location": "[parameters('primaryRegion')]",
      "properties": {
        "sku": {
          "name": "Basic"
        },
        "encryption": {
          "keySource": "Microsoft.Automation",
          "identity": {
            "userAssignedIdentity": "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('namingConvention').managedIdentity)]"
          }
        }
      },
      "tags": "[union(variables('enterpriseTags'), createObject('Purpose', 'Cost-Optimization', 'AutomationLevel', 'Advanced'))]"
    },
    {
      "type": "Microsoft.Automation/automationAccounts/runbooks",
      "apiVersion": "2023-11-01",
      "name": "[concat(variables('namingConvention').resourceGroup, '-automation/shutdown-dev-resources')]",
      "dependsOn": [
        "[resourceId('Microsoft.Automation/automationAccounts', concat(variables('namingConvention').resourceGroup, '-automation'))]"
      ],
      "properties": {
        "runbookType": "PowerShell",
        "logVerbose": true,
        "logProgress": true,
        "description": "Automated shutdown of development resources during off-hours",
        "publishContentLink": {
          "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/quickstarts/microsoft.automation/101-automation-runbook-getvms/Runbooks/Get-AzureVMTutorial.ps1",
          "version": "1.0.0.0"
        }
      }
    },
    {
      "condition": "[parameters('enableCostOptimization')]",
      "type": "Microsoft.Automation/automationAccounts/schedules",
      "apiVersion": "2020-01-13-preview",
      "name": "[concat(variables('namingConvention').resourceGroup, '-automation/daily-cost-optimization')]",
      "dependsOn": [
        "[resourceId('Microsoft.Automation/automationAccounts', concat(variables('namingConvention').resourceGroup, '-automation'))]"
      ],
      "properties": {
        "description": "Daily cost optimization schedule",
        "startTime": "[dateTimeAdd(utcNow(), 'PT1H')]",
        "frequency": "Day",
        "interval": 1,
        "timeZone": "UTC"
      }
    }
  ]
}
```

### Cost Optimization & Financial Management

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "description": "Enterprise cost optimization and financial management automation",
    "author": "Enterprise FinOps Team",
    "version": "2.1.0",
    "tags": ["Cost-Optimization", "FinOps", "Budget-Management", "Resource-Optimization"]
  },
  "parameters": {
    "costCenter": {
      "type": "string",
      "metadata": {
        "description": "Cost center for billing allocation"
      }
    },
    "budgetAmount": {
      "type": "int",
      "defaultValue": 10000,
      "metadata": {
        "description": "Monthly budget amount in USD"
      }
    },
    "optimizationLevel": {
      "type": "string",
      "defaultValue": "Standard",
      "allowedValues": ["Basic", "Standard", "Advanced", "Aggressive"],
      "metadata": {
        "description": "Level of cost optimization automation"
      }
    },
    "enableAutomatedShutdown": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable automated resource shutdown for non-production environments"
      }
    },
    "alertEmail": {
      "type": "string",
      "metadata": {
        "description": "Email address for budget and cost alerts"
      }
    }
  },
  "variables": {
    "costOptimizationConfig": {
      "Basic": {
        "budgetThresholds": [50, 80, 100],
        "automationLevel": "Manual",
        "rightsizingRecommendations": false
      },
      "Standard": {
        "budgetThresholds": [50, 75, 90, 100],
        "automationLevel": "Semi-Automated",
        "rightsizingRecommendations": true
      },
      "Advanced": {
        "budgetThresholds": [40, 60, 80, 95, 100],
        "automationLevel": "Automated",
        "rightsizingRecommendations": true,
        "predictiveScaling": true
      },
      "Aggressive": {
        "budgetThresholds": [30, 50, 70, 85, 95, 100],
        "automationLevel": "Full-Automation",
        "rightsizingRecommendations": true,
        "predictiveScaling": true,
        "autoShutdown": true
      }
    },
    "currentConfig": "[variables('costOptimizationConfig')[parameters('optimizationLevel')]]"
  },
  "resources": [
    {
      "type": "Microsoft.Consumption/budgets",
      "apiVersion": "2021-10-01",
      "name": "[concat('budget-', parameters('costCenter'), '-', resourceGroup().name)]",
      "properties": {
        "displayName": "[concat('Monthly Budget - ', parameters('costCenter'))]",
        "amount": "[parameters('budgetAmount')]",
        "timeGrain": "Monthly",
        "timePeriod": {
          "startDate": "[dateTimeAdd(utcNow(), 'P0D', 'yyyy-MM-01')]",
          "endDate": "[dateTimeAdd(utcNow(), 'P1Y', 'yyyy-MM-01')]"
        },
        "category": "Cost",
        "filters": {
          "resourceGroups": ["[resourceGroup().name]"],
          "tags": {
            "CostCenter": ["[parameters('costCenter')]"]
          }
        },
        "notifications": {
          "copy": [
            {
              "name": "budgetNotifications",
              "count": "[length(variables('currentConfig').budgetThresholds)]",
              "input": {
                "[concat('alert', variables('currentConfig').budgetThresholds[copyIndex('budgetNotifications')])]": {
                  "enabled": true,
                  "operator": "GreaterThan",
                  "threshold": "[variables('currentConfig').budgetThresholds[copyIndex('budgetNotifications')]]",
                  "contactEmails": ["[parameters('alertEmail')]"],
                  "contactGroups": [],
                  "thresholdType": "Actual"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Automation/automationAccounts",
      "apiVersion": "2023-11-01",
      "name": "[concat('aa-cost-optimization-', uniqueString(resourceGroup().id))]",
      "location": "[resourceGroup().location]",
      "identity": {
        "type": "SystemAssigned"
      },
      "properties": {
        "sku": {
          "name": "Basic"
        }
      },
      "tags": {
        "Purpose": "Cost-Optimization",
        "CostCenter": "[parameters('costCenter')]",
        "AutomationLevel": "[variables('currentConfig').automationLevel]"
      }
    },
    {
      "condition": "[parameters('enableAutomatedShutdown')]",
      "type": "Microsoft.Automation/automationAccounts/runbooks",
      "apiVersion": "2020-01-13-preview",
      "name": "[concat('aa-cost-optimization-', uniqueString(resourceGroup().id), '/rb-automated-shutdown')]",
      "dependsOn": [
        "[resourceId('Microsoft.Automation/automationAccounts', concat('aa-cost-optimization-', uniqueString(resourceGroup().id)))]"
      ],
      "properties": {
        "runbookType": "PowerShell",
        "logVerbose": true,
        "logProgress": true,
        "description": "Automated shutdown of non-production resources during off-hours",
        "draft": {
          "inEdit": false,
          "draftContentLink": {
            "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/quickstarts/microsoft.automation/101-automation-runbook-getvms/Runbooks/Get-AzureVMTutorial.ps1"
          }
        }
      }
    }
  ],
  "outputs": {
    "budgetId": {
      "type": "string",
      "value": "[resourceId('Microsoft.Consumption/budgets', concat('budget-', parameters('costCenter'), '-', resourceGroup().name))]"
    },
    "automationAccountId": {
      "type": "string",
      "value": "[resourceId('Microsoft.Automation/automationAccounts', concat('aa-cost-optimization-', uniqueString(resourceGroup().id)))]"
    },
    "optimizationLevel": {
      "type": "string",
      "value": "[parameters('optimizationLevel')]"
    }
  }
}
```

### Advanced Monitoring & Observability

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "description": "Enterprise monitoring and observability platform with Azure Monitor, Application Insights, and Log Analytics integration",
    "author": "Enterprise Platform Team",
    "version": "3.0.0",
    "tags": [
      "Monitoring",
      "Observability",
      "Azure-Monitor",
      "Application-Insights",
      "Log-Analytics"
    ]
  },
  "parameters": {
    "workspaceName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Log Analytics workspace"
      }
    },
    "applicationInsightsName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Application Insights instance"
      }
    },
    "retentionDays": {
      "type": "int",
      "defaultValue": 90,
      "allowedValues": [30, 60, 90, 120, 180, 270, 365, 550, 730, 1827, 2555],
      "metadata": {
        "description": "Data retention in days for Log Analytics workspace"
      }
    },
    "monitoringLevel": {
      "type": "string",
      "defaultValue": "Standard",
      "allowedValues": ["Basic", "Standard", "Advanced", "Premium"],
      "metadata": {
        "description": "Level of monitoring coverage and alerting"
      }
    },
    "enableNetworkWatcher": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable Network Watcher for network monitoring"
      }
    },
    "alertEmail": {
      "type": "string",
      "metadata": {
        "description": "Email address for monitoring alerts"
      }
    }
  },
  "variables": {
    "monitoringConfiguration": {
      "Basic": {
        "sku": "PerGB2018",
        "dailyQuotaGb": 1,
        "alertRules": 5,
        "workbooks": 2
      },
      "Standard": {
        "sku": "PerGB2018",
        "dailyQuotaGb": 5,
        "alertRules": 15,
        "workbooks": 5
      },
      "Advanced": {
        "sku": "PerGB2018",
        "dailyQuotaGb": 20,
        "alertRules": 30,
        "workbooks": 10
      },
      "Premium": {
        "sku": "PerGB2018",
        "dailyQuotaGb": 100,
        "alertRules": 50,
        "workbooks": 20
      }
    },
    "currentConfig": "[variables('monitoringConfiguration')[parameters('monitoringLevel')]]",
    "solutions": [
      "Security",
      "AgentHealthAssessment",
      "ChangeTracking",
      "Updates",
      "AzureActivity",
      "AzureAutomation",
      "AzureSQLAnalytics",
      "KeyVaultAnalytics",
      "NetworkMonitoring",
      "ServiceMap"
    ]
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces",
      "apiVersion": "2023-09-01",
      "name": "[parameters('workspaceName')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "sku": {
          "name": "[variables('currentConfig').sku]"
        },
        "retentionInDays": "[parameters('retentionDays')]",
        "workspaceCapping": {
          "dailyQuotaGb": "[variables('currentConfig').dailyQuotaGb]"
        },
        "features": {
          "searchVersion": 1,
          "legacy": 0,
          "enableLogAccessUsingOnlyResourcePermissions": true
        },
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled"
      },
      "tags": {
        "Purpose": "Enterprise-Monitoring",
        "MonitoringLevel": "[parameters('monitoringLevel')]",
        "RetentionDays": "[string(parameters('retentionDays'))]"
      }
    },
    {
      "copy": {
        "name": "monitoringSolutions",
        "count": "[length(variables('solutions'))]"
      },
      "type": "Microsoft.OperationsManagement/solutions",
      "apiVersion": "2015-11-01-preview",
      "name": "[concat(variables('solutions')[copyIndex()], '(', parameters('workspaceName'), ')')]",
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceName'))]"
      ],
      "plan": {
        "name": "[concat(variables('solutions')[copyIndex()], '(', parameters('workspaceName'), ')')]",
        "promotionCode": "",
        "product": "[concat('OMSGallery/', variables('solutions')[copyIndex()])]",
        "publisher": "Microsoft"
      },
      "properties": {
        "workspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceName'))]"
      }
    },
    {
      "type": "Microsoft.Insights/components",
      "apiVersion": "2020-02-02",
      "name": "[parameters('applicationInsightsName')]",
      "location": "[resourceGroup().location]",
      "kind": "web",
      "dependsOn": [
        "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceName'))]"
      ],
      "properties": {
        "Application_Type": "web",
        "WorkspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceName'))]",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "RetentionInDays": "[parameters('retentionDays')]"
      },
      "tags": {
        "Purpose": "Application-Monitoring",
        "MonitoringLevel": "[parameters('monitoringLevel')]"
      }
    },
    {
      "type": "Microsoft.Insights/actionGroups",
      "apiVersion": "2023-01-01",
      "name": "enterprise-monitoring-alerts",
      "location": "global",
      "properties": {
        "groupShortName": "EntMonitor",
        "enabled": true,
        "emailReceivers": [
          {
            "name": "Enterprise-Monitoring-Team",
            "emailAddress": "[parameters('alertEmail')]",
            "useCommonAlertSchema": true
          }
        ],
        "smsReceivers": [],
        "webhookReceivers": [],
        "azureAppPushReceivers": [],
        "automationRunbookReceivers": []
      },
      "tags": {
        "Purpose": "Alert-Management"
      }
    },
    {
      "condition": "[parameters('enableNetworkWatcher')]",
      "type": "Microsoft.Network/networkWatchers",
      "apiVersion": "2023-09-01",
      "name": "[concat('nw-', resourceGroup().location)]",
      "location": "[resourceGroup().location]",
      "properties": {},
      "tags": {
        "Purpose": "Network-Monitoring"
      }
    }
  ],
  "outputs": {
    "workspaceId": {
      "type": "string",
      "value": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceName'))]"
    },
    "workspaceCustomerId": {
      "type": "string",
      "value": "[reference(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceName')), '2023-09-01').customerId]"
    },
    "applicationInsightsId": {
      "type": "string",
      "value": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
    },
    "instrumentationKey": {
      "type": "string",
      "value": "[reference(resourceId('Microsoft.Insights/components', parameters('applicationInsightsName')), '2020-02-02').InstrumentationKey]"
    },
    "connectionString": {
      "type": "string",
      "value": "[reference(resourceId('Microsoft.Insights/components', parameters('applicationInsightsName')), '2020-02-02').ConnectionString]"
    }
  }
}
```

### Disaster Recovery & Backup Automation

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "description": "Enterprise disaster recovery and backup automation with Azure Site Recovery and Azure Backup",
    "author": "Enterprise DR Team",
    "version": "2.0.0",
    "tags": ["Disaster-Recovery", "Backup", "Business-Continuity", "Site-Recovery"]
  },
  "parameters": {
    "primaryRegion": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Primary region for resources"
      }
    },
    "secondaryRegion": {
      "type": "string",
      "metadata": {
        "description": "Secondary region for disaster recovery"
      }
    },
    "recoveryTimeObjective": {
      "type": "string",
      "defaultValue": "4-hours",
      "allowedValues": ["1-hour", "4-hours", "8-hours", "24-hours"],
      "metadata": {
        "description": "Recovery Time Objective (RTO) requirement"
      }
    },
    "backupRetention": {
      "type": "string",
      "defaultValue": "LongTermRetention",
      "allowedValues": ["ShortTermRetention", "LongTermRetention", "ArchiveRetention"],
      "metadata": {
        "description": "Backup retention policy type"
      }
    }
  },
  "variables": {
    "backupPolicies": {
      "ShortTermRetention": {
        "dailySchedule": {
          "retentionDuration": {
            "count": 30,
            "durationType": "Days"
          }
        }
      },
      "LongTermRetention": {
        "dailySchedule": {
          "retentionDuration": {
            "count": 90,
            "durationType": "Days"
          }
        },
        "weeklySchedule": {
          "retentionDuration": {
            "count": 52,
            "durationType": "Weeks"
          }
        },
        "yearlySchedule": {
          "retentionDuration": {
            "count": 7,
            "durationType": "Years"
          }
        }
      }
    }
  },
  "resources": [
    {
      "type": "Microsoft.RecoveryServices/vaults",
      "apiVersion": "2023-06-01",
      "name": "[concat('rsv-backup-', parameters('primaryRegion'))]",
      "location": "[parameters('primaryRegion')]",
      "sku": {
        "name": "RS0",
        "tier": "Standard"
      },
      "properties": {
        "redundancySettings": {
          "standardTierStorageRedundancy": "GeoRedundant",
          "crossRegionRestore": "Enabled"
        }
      },
      "tags": {
        "Purpose": "Enterprise-Backup",
        "RTO": "[parameters('recoveryTimeObjective')]"
      }
    }
  ],
  "outputs": {
    "primaryVaultId": {
      "type": "string",
      "value": "[resourceId('Microsoft.RecoveryServices/vaults', concat('rsv-backup-', parameters('primaryRegion')))]"
    }
  }
}
```

### Azure Policy & Governance Automation

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "description": "Enterprise Azure Policy and governance automation for compliance and security enforcement",
    "author": "Enterprise Governance Team",
    "version": "3.0.0",
    "tags": ["Governance", "Azure-Policy", "Compliance", "Security-Enforcement"]
  },
  "parameters": {
    "governanceLevel": {
      "type": "string",
      "defaultValue": "Standard",
      "allowedValues": ["Basic", "Standard", "Advanced", "Strict"],
      "metadata": {
        "description": "Level of governance enforcement"
      }
    },
    "complianceFramework": {
      "type": "string",
      "defaultValue": "CIS",
      "allowedValues": ["CIS", "NIST", "SOC2", "PCI-DSS", "HIPAA"],
      "metadata": {
        "description": "Primary compliance framework to enforce"
      }
    },
    "exemptResourceGroups": {
      "type": "array",
      "defaultValue": [],
      "metadata": {
        "description": "Resource groups to exempt from certain policies"
      }
    }
  },
  "variables": {
    "governanceConfigs": {
      "Basic": {
        "enforcementMode": "DoNotEnforce",
        "requiredTags": ["Environment", "Owner"],
        "securityPolicies": 5
      },
      "Standard": {
        "enforcementMode": "Default",
        "requiredTags": ["Environment", "Owner", "CostCenter", "Project"],
        "securityPolicies": 15
      },
      "Advanced": {
        "enforcementMode": "Default",
        "requiredTags": ["Environment", "Owner", "CostCenter", "Project", "DataClassification", "BackupRequired"],
        "securityPolicies": 25
      },
      "Strict": {
        "enforcementMode": "Default",
        "requiredTags": ["Environment", "Owner", "CostCenter", "Project", "DataClassification", "BackupRequired", "ComplianceFramework", "SecurityZone"],
        "securityPolicies": 40
      }
    },
    "currentConfig": "[variables('governanceConfigs')[parameters('governanceLevel')]]"
  },
  "resources": [
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "apiVersion": "2023-04-01",
      "name": "enterprise-required-tags-policy",
      "properties": {
        "displayName": "Enterprise Required Tags Policy",
        "description": "Enforces required tags on all resources for governance and cost management",
        "policyType": "Custom",
        "mode": "Indexed",
        "metadata": {
          "category": "Tags",
          "version": "2.0.0"
        },
        "parameters": {
          "requiredTags": {
            "type": "Object",
            "metadata": {
              "displayName": "Required Tags",
              "description": "Object containing required tag names and their allowed values"
            },
            "defaultValue": {
              "Environment": ["Production", "Staging", "Development", "Sandbox"],
              "Owner": [],
              "CostCenter": []
            }
          }
        },
        "policyRule": {
          "if": {
            "allOf": [
              {
                "field": "type",
                "notEquals": "Microsoft.Resources/resourceGroups"
              },
              {
                "anyOf": {
                  "copy": [
                    {
                      "name": "tagConditions",
                      "count": "[length(variables('currentConfig').requiredTags)]",
                      "input": {
                        "not": {
                          "field": "[concat('tags[', variables('currentConfig').requiredTags[copyIndex('tagConditions')], ']')]",
                          "exists": "true"
                        }
                      }
                    }
                  ]
                }
              }
            ]
          },
          "then": {
            "effect": "deny"
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policySetDefinitions",
      "apiVersion": "2023-04-01",
      "name": "enterprise-security-baseline",
      "dependsOn": [
        "[resourceId('Microsoft.Authorization/policyDefinitions', 'enterprise-required-tags-policy')]"
      ],
      "properties": {
        "displayName": "Enterprise Security Baseline Initiative",
        "description": "Comprehensive security baseline for enterprise Azure deployments",
        "policyType": "Custom",
        "metadata": {
          "category": "Security",
          "version": "3.0.0",
          "compliance": "[parameters('complianceFramework')]"
        },
        "parameters": {
          "effect": {
            "type": "String",
            "defaultValue": "[variables('currentConfig').enforcementMode]",
            "allowedValues": ["Audit", "Deny", "Disabled", "AuditIfNotExists", "DeployIfNotExists"]
          }
        },
        "policyDefinitions": [
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions', 'enterprise-required-tags-policy')]",
            "parameters": {}
          },
          {
            "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9",
            "parameters": {
              "effect": {
                "value": "[parameters('effect')]"
              }
            }
          },
          {
            "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d",
            "parameters": {
              "effect": {
                "value": "[parameters('effect')]"
              }
            }
          },
          {
            "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490",
            "parameters": {
              "effect": {
                "value": "[parameters('effect')]"
              }
            }
          }
        ]
      }
    },
    {
      "type": "Microsoft.Authorization/policyAssignments",
      "apiVersion": "2022-06-01",
      "name": "enterprise-governance-assignment",
      "dependsOn": [
        "[resourceId('Microsoft.Authorization/policySetDefinitions', 'enterprise-security-baseline')]"
      ],
      "identity": {
        "type": "SystemAssigned"
      },
      "location": "[resourceGroup().location]",
      "properties": {
        "displayName": "Enterprise Governance Policy Assignment",
        "description": "Assignment of enterprise governance policies for compliance and security",
        "policyDefinitionId": "[resourceId('Microsoft.Authorization/policySetDefinitions', 'enterprise-security-baseline')]",
        "scope": "[subscription().id]",
        "notScopes": "[parameters('exemptResourceGroups')]",
        "enforcementMode": "[variables('currentConfig').enforcementMode]",
        "parameters": {
          "effect": {
            "value": "[variables('currentConfig').enforcementMode]"
          }
        }
      }
    }
  ],
  "outputs": {
    "policyDefinitionId": {
      "type": "string",
      "value": "[resourceId('Microsoft.Authorization/policyDefinitions', 'enterprise-required-tags-policy')]"
    },
    "policySetDefinitionId": {
      "type": "string",
      "value": "[resourceId('Microsoft.Authorization/policySetDefinitions', 'enterprise-security-baseline')]"
    },
    "policyAssignmentId": {
      "type": "string",
      "value": "[resourceId('Microsoft.Authorization/policyAssignments', 'enterprise-governance-assignment')]"
    }
  }

When implementing Azure ARM Templates for enterprise environments:

#### ðŸŽ¯ Template Architecture Guidelines

1. **Multi-Subscription Orchestration**: Design templates for enterprise-scale multi-subscription deployments with proper governance and policy enforcement
2. **Compliance-First Approach**: Integrate compliance frameworks (SOC2, PCI-DSS, HIPAA, CIS, NIST) as first-class citizens in template design
3. **Security-by-Design**: Implement comprehensive security controls including Key Vault integration, Managed Identity, RBAC, and network isolation
4. **Enterprise Naming Conventions**: Use consistent, hierarchical naming patterns that support governance and cost management

#### ðŸ”§ Template Development Best Practices

1. **Advanced Parameter Validation**: Implement comprehensive parameter validation with business logic constraints and metadata descriptions
2. **Conditional Resource Deployment**: Use sophisticated conditional logic for environment-specific and compliance-driven resource provisioning
3. **Nested Template Orchestration**: Design modular template architectures using nested templates and Bicep modules for maintainability
4. **Enterprise Copy Loops**: Implement intelligent copy patterns for multi-region, multi-environment deployments with proper dependency management

#### ðŸ“Š Monitoring & Observability Integration

1. **Azure Monitor Native**: Build comprehensive monitoring into templates with Log Analytics, Application Insights, and Sentinel integration
2. **Enterprise Dashboards**: Create sophisticated workbooks and dashboards for infrastructure, security, compliance, and cost monitoring
3. **Automated Alerting**: Implement multi-tiered alerting for operational, security, and budget thresholds with proper escalation
4. **Compliance Reporting**: Integrate automated compliance reporting and audit trail generation

#### ðŸš€ CI/CD Pipeline Integration

1. **Multi-Stage Validation**: Implement comprehensive validation including JSON syntax, ARM TTK, security scanning, and compliance checking
2. **Environment Promotion**: Design proper promotion workflows with what-if analysis, approval gates, and rollback capabilities
3. **Security Integration**: Include automated security scanning, secret detection, and policy validation in deployment pipelines
4. **Cost Governance**: Integrate budget controls and cost analysis into deployment workflows

#### ðŸ’¡ Enterprise Code Generation Principles

- Generate templates with comprehensive metadata, documentation, and enterprise tagging strategies
- Include proper error handling, validation, and diagnostic information for operational excellence
- Implement sophisticated parameter files for different environments, regions, and compliance requirements
- Create modular, reusable components that can be composed for different enterprise scenarios
- Design templates that support both imperative deployment automation and declarative configuration management
- Follow ARM template function best practices
- Generate modular templates suitable for nested deployment architectures
- Consider Bicep alternatives for complex template scenarios

```

```

```
